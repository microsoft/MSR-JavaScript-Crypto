//*******************************************************************************
//
//    Copyright 2020 Microsoft
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
//
//*******************************************************************************
"use strict";var msrCryptoVersion="1.6.6";!function(e,r){"function"==typeof define&&define.amd?define([],function(){return e.msrCrypto=r(e)}):"object"==typeof exports?module.exports=r(e):e.msrCrypto=r(e)}(this,function(e){e=e||{};return function(){var r={register:function(e,t,n){r[e]||(r[e]={});var o=r[e];o[t]||(o[t]=n)},exists:function(e,t){return!!r[e]&&!!r[e][t]}},t=function(){if("undefined"!=typeof document)try{throw new Error}catch(r){if(r.stack){var e=/\w+:\/\/(.+?\/)*.+\.js/.exec(r.stack);return e&&e.length>0?e[0]:null}}else if("undefined"!=typeof self&&void 0!==self.location)return self.location.href;return null}(),n="undefined"!=typeof Worker,o="function"==typeof importScripts&&self instanceof WorkerGlobalScope,a=!1,s="undefined"!=typeof ArrayBuffer,u=function(){try{return Object.defineProperty({},"oncomplete",{}),!0}catch(e){return!1}}(),l=!1,c=function(e,r,t,n,o){if(u){var a={};n&&(a.get=n),o&&(a.set=o),Object.defineProperty(e,r,a)}else e[r]=t},f={},y=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(r){for(r=r.replace(/-/g,"+").replace(/_/g,"/");r.length%4!=0;)r+="=";var t,n,o,a,i,s,u,l=[];for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<r.length;u+=4)t=e.indexOf(r.charAt(u))<<2|(a=e.indexOf(r.charAt(u+1)))>>4,n=(15&a)<<4|(i=e.indexOf(r.charAt(u+2)))>>2,o=(3&i)<<6|(s=e.indexOf(r.charAt(u+3))),l.push(t),64!==i&&l.push(n),64!==s&&l.push(o);return l}function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function n(e){return[e>>>24&255,e>>>16&255,e>>>8&255,255&e]}function o(e){if(!e)return[];if(e.pop)return e;if("ArrayBuffer"===t(e)?e=new Uint8Array(e):e.BYTES_PER_ELEMENT>1&&(e=new Uint8Array(e.buffer)),1===e.length)return[e[0]];if(e.length<65536)return Array.apply(null,e);for(var r=new Array(e.length),n=0;n<e.length;n++)r[n]=e[n];return r}function a(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}return{consoleLog:function(e){"console"in self&&"log"in console&&console.log(e)},toBase64:function(r,n){var a=t(r);if("Array"!==a&&"Uint8Array"!==a&&"ArrayBuffer"!==a)throw new Error("invalid input");var i,s,u,l,c,f,y,h,g="",p=o(r);for(n||(n=!1),h=0;h<p.length;h+=3)l=(i=p[h])>>2,c=(3&i)<<4|(s=p[h+1])>>4,f=(15&s)<<2|(u=p[h+2])>>6,y=63&u,isNaN(s)?f=y=64:isNaN(u)&&(y=64),g=g+e.charAt(l)+e.charAt(c)+e.charAt(f)+e.charAt(y);return n?g.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""):g},fromBase64:r,checkParam:function(e,r,n){if(!e)throw new Error(n);if(r&&t(e)!==r)throw new Error(n);return!0},getObjectType:t,bytesToHexString:function(e,r){var t="";void 0===r&&(r=!1);for(var n=0;n<e.length;n++){r&&n%4==0&&0!==n&&(t+="-");var o=e[n].toString(16).toUpperCase();1===o.length&&(t+="0"),t+=o}return t},bytesToInt32:function(e,r){return e[r=r||0]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]},stringToBytes:function(e){for(var r=[],t=0,n=0;t<e.length;t++){var o=e.charCodeAt(t);o<128?r[n++]=o:o<2048?(r[n++]=o>>>6|192,r[n++]=63&o|128):o<55296||o>57343?(r[n++]=o>>>12|224,r[n++]=o>>>6&63|128,r[n++]=63&o|128):(o=1024*(o-55296)+(e.charCodeAt(++t)-56320)+65536,r[n++]=o>>>18|240,r[n++]=o>>>12&63|128,r[n++]=o>>>6&63|128,r[n++]=63&o|128)}return r},bytesToString:function(e){var r,t="";e=o(e);for(var n=0;n<e.length;){var a=e[n++];if((r=a<128?a:a<224?(a<<6)+e[n++]-12416:a<240?(a<<12)+(e[n++]<<6)+e[n++]-925824:(a<<18)+(e[n++]<<12)+(e[n++]<<6)+e[n++]-63447168)>65535){var i=Math.floor((r-65536)/1024)+55296,s=(r-65536)%1024+56320;t+=String.fromCharCode(i,s)}else t+=String.fromCharCode(r)}return t},unpackData:function(e,t,n){var o,a=r(e),i=[];if(isNaN(t))return a;for(o=0;o<a.length;o+=t)i.push(a.slice(o,o+t));if(n)for(o=0;o<i.length;o++)i[o]=(i[o][0]<<24)+(i[o][1]<<16)+(i[o][2]<<8)+i[o][3];return i},hexToBytesArray:function(e){e=e.replace(/\-/g,"");for(var r=[];e.length>=2;)r.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return r},int32ToBytes:n,int32ArrayToBytes:function(e){for(var r=[],t=0;t<e.length;t++)r=r.concat(n(e[t]));return r},toArray:o,arraysEqual:function(e,r){var t=!0;e.length!==r.length&&(t=!1);for(var n=0;n<e.length;n++)e[n]!==r[n]&&(t=!1);return t},clone:function(e){var r={};for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},xorVectors:function(e,r,t){for(var n=Math.min(e.length,r.length),o=(t=t||new Array(n),0);o<n;o+=1)t[o]=e[o]^r[o];return t},padEnd:function(e,r,t){for(;e.length<t;)e.push(r);return e},padFront:function(e,r,t){for(;e.length<t;)e.unshift(r);return e},getVector:function(e,r){isNaN(r)&&(r=0);for(var t=new Array(e),n=0;n<e;n+=1)t[n]=r;return t},verifyByteArray:function(e){if("Array"!==t(e))return!1;for(var r,n=0;n<e.length;n++)if(r=e[n],isNaN(r)||r<0||r>255)return!1;return!0},error:function(e,r){var t=Error(r);throw t.name=e,t},isBytes:function(e){if(!(e instanceof Array))return!1;for(var r=0;r<e.length;r++){var t=e[r];if(!a(t)||t>255||t<0)return!1}return!0},isInteger:a}}(),h=function(){var e={0:"CUSTOM",1:"BOOLEAN",2:"INTEGER",3:"BIT STRING",4:"OCTET STRING",5:"NULL",6:"OBJECT IDENTIFIER",16:"SEQUENCE",17:"SET",19:"PRINTABLE STRING",23:"UTCTime"};function r(e){var r=e.length;if(r<=127)return[r];var n=t(r);return n.unshift(128|n.length),n}function t(e){var r=[];if(0===e)return[0];for(;e>0;)r.unshift(255&e),e>>>=8;return r}return{parse:function r(t,n){n=!!n;var o,a,i,s=e[31&t[0]],u=t[1],l=0,c=!!(32&t[0]);if(128&u)for(l=0,u=0;l<(127&t[1]);l++)u=(u<<8)+t[2+l];if(i=2+l,void 0===s||u>t.length)return null;var f=c?[]:{};if(f.type=s,f.header=i,f.data=t.slice(0,u+i),c||n)for("BIT STRING"===f.type&&0===t[i]&&l++,o=t.slice(i,f.data.length);o.length>0&&null!==(a=r(o));)f.push(a),o=o.slice(a.data.length);return f},encode:function e(n){if(n.hasOwnProperty("INTEGER")){var o=n.INTEGER;return y.isInteger(o)&&(o=t(o)),128&o[0]&&o.unshift(0),[2].concat(r(o),o)}if(n.hasOwnProperty("OCTET STRING"))return(o=n["OCTET STRING"])instanceof Array||(o=e(o)),[4].concat(r(o),o);if(n.hasOwnProperty("BIT STRING"))return(o=n["BIT STRING"])instanceof Array||(o=e(o)),o.unshift(0),[3].concat(r(o),o);if(n.hasOwnProperty("NULL"))return[5,0];if(n.hasOwnProperty("OBJECT IDENTIFIER"))return o=function(e){for(var r=e.split("."),t=[parseInt(40*r[0]+parseInt(r[1]))],n=2;n<r.length;n++){for(var o=parseInt(r[n]),a=[];o>0;)a.push(127&o|128),o>>>=7;a[0]=127&a[0],t=t.concat(a.reverse())}return t}(n["OBJECT IDENTIFIER"]),[6].concat(r(o),o);if(n.hasOwnProperty("SEQUENCE")){for(var a=n.SEQUENCE,i=(o=[],0);i<a.length;i++)o=o.concat(e(a[i]));return[48].concat(r(o),o)}if(n.hasOwnProperty("APPLICATION")){a=n.APPLICATION;var s=isNaN(parseInt(a[0]))?32:0,u=n.tag;if(o=s?[]:n.APPLICATION,s)for(i=0;i<a.length;i++)o=o.concat(e(a[i]));return[160|s|u].concat(r(o),o)}throw new Error("unsupported asn.1 type")},toString:function(e){return function e(r,t){var n=new Array(t+1).join(" ")+r.type+" ("+r.length+") "+bytesToHexString(r.data).substring(0,16)+"\n";if(!r.children)return n;for(var o=0;o<r.children.length;o++)n+=e(r.children[o],t+4)+"";return n}(e,0)}}}();var g=function(){function e(e){return a&&o&&self.postMessage(e),e}return{jsCryptoRunner:function(t){t.data.workerid,t.data.operationType,t.data.operationSubType;var n=t.data.operationType,o=r[n][t.data.algorithm.name],a=t.data;if(!r.exists(n,t.data.algorithm.name))throw new Error("unregistered algorithm.");return a.operationSubType?e({type:a.operationSubType,result:o(a)}):e(o(a))},returnResult:e}}();o&&(self.onmessage=function(e){if(!a&&e.data.prngSeed){var r=e.data.prngSeed;return Z.init(r),a=!0,g.returnResult({initialized:!0})}!0===a&&g.jsCryptoRunner(e)});var p=function(){var e=y;function r(e){var r=e.algorithm.name.slice(0,3).toUpperCase();return"RSA"===r?"RSA":"ECD"===r?"EC":"oct"}function t(e){return e.hash.name.substring(e.hash.name.indexOf("-")+1)}var n={HMAC:function(e){return"HS"+t(e)},"AES-CBC":function(e){return"A"+e.length.toString()+"CBC"},"AES-GCM":function(e){return"A"+e.length.toString()+"GCM"},"AES-KW":function(e){return"A"+e.length.toString()+"KW"},"RSAES-PKCS1-V1_5":function(e){return"RSA1_5"},"RSASSA-PKCS1-V1_5":function(e){return"RS"+t(e)},"RSA-OAEP":function(e){return"SHA-1"===e.hash.name.toUpperCase()?"RSA-OAEP":"RSA-OAEP-"+t(e)},"RSA-PSS":function(e){return"PS"+t(e)},ECDSA:function(e){return"EC-"+e.namedCurve.substring(e.namedCurve.indexOf("-")+1)}};return{keyToJwkOld:function(t,n){var o={};if(o.kty=r(t),o.extractable=t.extractable,n.pop)o.k=e.toBase64(n,!0);else for(var a in n)n[a].pop&&(o[a]=e.toBase64(n[a],!0));return t.algorithm.namedCurve&&(o.crv=t.algorithm.namedCurve),function(e){for(var r=[],t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return 0===r[r.length-1]&&r.pop(),r}(JSON.stringify(o,null,"\t"))},keyToJwk:function(t,o){var a={};if(a.kty=r(t),a.ext=t.extractable,n[t.algorithm.name.toUpperCase()]&&(a.alg=n[t.algorithm.name.toUpperCase()](t.algorithm)),a.key_ops=t.usages,o.pop)a.k=e.toBase64(o,!0);else for(var i in o)o[i].pop&&"key_ops"!==i&&(a[i]=e.toBase64(o[i],!0));return t.algorithm.namedCurve&&(a.crv=t.algorithm.namedCurve),a},jwkToKey:function(r,t,n){for(var o=JSON.parse(JSON.stringify(r)),a=0;a<n.length;a+=1){var i=o[n[a]];i&&(o[n[a]]=e.fromBase64(i))}return o}}}();var d=d||function(){for(var e=24,r=Math.floor(e/8),t=(1<<e)-1,n=1<<e,o=t,a=1/n,i=[1,256],s=2;s<=r;s++)i[s]=256*i[s-1];var u=[0],l=[1];function c(e){var r,t=null;if(arguments.length&&"number"!=typeof arguments[0]){if("object"==typeof arguments[0])for(t=new Array(e.length),r=0;r<e.length;r+=1)t[r]=e[r]}else for(t=new Array(e),r=0;r<e;r+=1)t[r]=0;return t}function f(e,r,t,n,o){for(;o-- >0;)t[n+o]=e[r+o]}function y(e){var r,t=0;for(r=0;r<e.length;r+=1)t|=e[r];return!t}function h(e){var t=Math.floor((e.length+r-1)/r),o=new Array(t);o[0]=0;for(var a=0,s=0,u=0,l=e.length-1;l>=0;l--)a+=i[u++]*(255&e[l]),i[u]===n&&(u=0,o[s++]=a,a=0);for(0!==a&&(o[s]=a);null==o[--t];)o[t]=0;return o}function g(r,t){if(void 0===t)if(r<=1)t=1;else{var o=Math.log(r)/Math.LN2;t=Math.ceil(o/e)}for(var a=[];r>0;)a.push(r%n),r=Math.floor(r/n);for(;a.length<t;)a.push(0);return a}function p(e){for(var r=e.length-1;r>=0;r--)if(void 0!==e[r]&&0!==e[r])return r;return 0===e[0]?-1:0}function v(e,r){var t,n,o=0;for(n=0;n<Math.max(e.length,r.length);n++)o=(t=~~e[n]-~~r[n])+(o&-!t);return o}function m(e,r,t){var n=p(e);if(e.length=r||n+1,t)for(;++n<e.length;)e[n]=0;return e.length<=0&&(e[0]=0,e.length=1),e}function w(r,n,o,a){if(void 0===o)o=1;else if(o>=e||o<0)throw new Error("bit count must be smaller than DIGIT_BITS and positive in shiftLeft");void 0===a&&(a=r.length);var i=e-o;n[a]=r[a-1]>>>e-o||n[a];for(var s=a-1;s>0;s--)n[s]=(r[s]<<o|r[s-1]>>>i)&t;n[0]=r[0]<<o&t}function k(r,n,o){var a=r,i=n;n.length<r.length&&(a=n,i=r);var s,u=a.length,l=0;for(s=0;s<u;s+=1)l+=a[s]+i[s],o[s]=l&t,l>>=e;for(s=u;s<i.length;s+=1)l+=i[s],o[s]=l&t,l>>=e;return o.length=i.length,0!==l&&(o[s]=l&t),l}function E(r,n,o){var a=n.length;if(r.length<n.length&&(a=p(n)+1,r.length<a))throw new Error("Subtrahend is longer than minuend, not supported.");var i,s=0;for(i=0;i<a;i+=1)s+=r[i]-n[i],o[i]=s&t,s>>=e;for(;i<r.length;)s+=r[i],o[i++]=s&t,s>>=e;return s}function b(e,r,n){r="number"==typeof r?[r]:r;var o,i,s,u,l,c,f,y,h=e.length,g=r.length;for(o=0;o<h+g;o+=1)n[o]=0;o=0,u=0;for(var p=0;o<g;){for(u=Math.min(u+31,g);o<u;o++)for(y=r[o],i=0;i<h;i++)n[o+i]+=e[i]*y;for(l=0,s=p;s<o+h;s++)f=(c=n[s]+l)&t,n[s]=f,l=(c-f)*a;n[s]=l,p+=31}return n.length=h+g,n}function x(r,o,a,i,s,u){var l,c,y,h,g,d,v,k=p(r)+1,E=p(o)+1;if(k<E)return f(r,0,i,0,r.length),i.length=r.length,m(i),a[0]=0,void(a.length=1);if(0===E||1===E&&0===o[E-1])throw new Error("Division by zero.");if(1===E){for(g=o[0],c=0,v=k-1;v>=0;v--)h=c*n+r[v],a[v]=h/g&t,c=h-a[v]*g&t;return a.length=k,m(a),i[0]=c,void(i.length=1)}var b=e-1-function(r){for(var t=0,n=0;n<e;n++)t=Math.max(t,-(r>>>n&1)&n);return t}(o[E-1]),x=s||[];x.length=E,w(o,x,b,E);var S=u||[];for(S.length=k,w(r,S,b,k),S[k]=S[k]||0,a.length=k-E+1,i.length=E,v=k-E;v>=0;v--){for(l=Math.floor((S[v+E]*n+S[v+E-1])/x[E-1]),c=S[v+E]*n+S[v+E-1]-l*x[E-1];(l>=n||l*x[E-2]>c*n+S[v+E-2])&&(l-=1,(c+=x[E-1])<n););for(y=0,d=0;d<E;d++)h=l*x[d],g=S[d+v]-y-(h&t),S[d+v]=g&t,y=Math.floor(h/n)-Math.floor(g/n);if(g=S[v+E]-y,S[v+E]=g&t,a[v]=l&t,g<0){for(a[v]=a[v]-1,y=0,d=0;d<E;d++)g=S[d+v]+x[d]+y,S[d+v]=g&t,y=g>>e;S[v+E]=S[v+E]+y&t}}for(d=0;d<E;d++)i[d]=(S[d]>>>b|S[d+1]<<e-b)&t;m(a),m(i)}function S(e,r,t,n,o){var a;if(y(e))return f(r,0,o,0,r.length),o.length=r.length,0;if(y(r))return f(e,0,o,0,e.length),o.length=e.length,0;v(e,r)<0?(a=e.slice(0),f(r,0,o,0,r.length),o.length=r.length):(a=r.slice(0),f(e,0,o,0,e.length),o.length=e.length),m(o),m(a);var i,s,u=new Array(o.length),l=new Array(o.length),c=new Array(o.length),h=void 0!==n;h&&((i=new Array(o.length))[0]=1,i.length=1,n[0]=0,n.length=1);var g=new Array(o.length),p=void 0!==t;p&&((s=new Array(o.length))[0]=0,s.length=1,t[0]=1,t.length=1);for(var d,w=-1,E=t,S=n,A=o;!y(a);)x(o,a,u,l,g,c),p&&(b(u,s,g),k(g,t,g),m(g),d=t,t=s,s=g,g=d),h&&(b(u,i,c),k(c,n,c),m(c),d=n,n=i,i=c,c=d),d=o,o=a,a=l,l=d,w++;return p&&(f(t,0,E,0,t.length),E.length=t.length),h&&(f(n,0,S,0,n.length),S.length=n.length),f(o,0,A,0,o.length),A.length=o.length,w}function A(e,r,t,n){if(n=n||[],0===v(r,u))n[0]=1;else if(0===v(r,l))f(e,0,n,0,e.length),n.length=e.length;else{var o=new D(t);m(e,o.s,!0),o.modExp(e,r,n),n.length=t.length}return n}function D(r,n){function o(r){for(var n=1,o=2,a=3,i=a&r,s=2;s<=e;s+=1)o<i&&(n+=o),o<<=1,i=r*n&(a=a<<1|1);return 1+(~n&t)}function i(e,r,n,o){for(var i,s,l,f,y,h,g,p,v=(o=o||this).m,m=v.length,w=o.mPrime,k=o.m0,E=0,b=0,x=c(m+2);E<m;){for(b=Math.min(m,b+16);E<b;){for(i=~~r[E],l=((s=x[0]+e[0]*i)&t)*w&t,x[1]+=(k*l+s)*a|0,f=1,y=0;f<m;y=f,f+=1)x[y]=x[f]+v[f]*l+e[f]*i;x[y]=x[f],x[f]=0,E++}for(p=0,f=0;f<m;f++)g=(h=x[f]+p)&t,x[f]=g,p=(h-g)*a;x[f]=p}for(E=0;E<m;E+=1)n[E]=x[E];n.length=m;var S=+(d.compareDigits(x,v)>0);d.subtract(n,v,o.temp2),u(S,n,o.temp2)}function s(e,r,t){var n,o,a,i,s;for(n=0;n<e[0].length;n++)t[n]=0;for(o=0;o<e.length;o++)for(i=e[o],a=-(r===o),s=0;s<i.length;s++)t[s]=t[s]|i[s]&a}function u(e,r,t){for(var n=-e,o=~n,a=0;a<r.length;a++)r[a]=r[a]&o|t[a]&n}var l=(n=n||function(e){var r=e.length,t=e[0],n={m:e,mPrime:o(t),m0:t,temp1:c(2*r+1),temp2:c(2*r+1)},a=c(2*e.length);a[a.length]=1,n.mu=[],x(a,e,n.mu,[]);var s=c(2*r+1),u=c(r+1),l=c(2*r+1),f=c(2*r+1),y=u;y[r]=1,x(y,e,s,u,l,f),n.rModM=m(u,r,!0);var h=c(2*r+1),g=h;return g[2*r]=1,x(g,e,s,h,l,f),n.rSquaredModm=m(h,r,!0),n.rCubedModm=c(r),i(h,h,n.rCubedModm,n),n}(r)).m,f=n.mu,y=n.m0,h=l.length,g=c(h+1).slice(0,h);g[0]=1;var p=n.mPrime,w=n.rModM,k=n.rSquaredModm,S=n.rCubedModm,A=c(2*h+1),D=c(2*h+1),T=new Array(4);return T[0]=w,T[1]=new Array(h),T[2]=new Array(h),T[3]=new Array(h),{m:l,m0:y,mPrime:p,mu:f,rSquaredModm:k,s:h,rModM:w,rCubedModm:S,one:g,temp1:A,temp2:D,convertToMontgomeryForm:function(e){if(e.length<this.s){e.length=this.s;for(var r=0;r<this.s;r++)e[r]=isNaN(e[r])?0:e[r]}var t=c(e.length);for(this.montgomeryMultiply(e,this.rSquaredModm,t),r=0;r<this.s;r+=1)e[r]=t[r]},convertToStandardForm:function(e){this.montgomeryMultiply(e,this.one,this.temp1);for(var r=0;r<this.s;r+=1)e[r]=this.temp1[r]},montgomeryMultiply:i,modExp:function(r,t,n,o){o=!!o;var a,i,u=function(r){var t,n,o=2,a=r*e;n=4+3*Math.ceil(a/2)+1;do{o++,t=n,n=Math.pow(2,o)+Math.ceil(a/o)*(o+1)+1}while(n<t);return o-1}(t.length),l=function(r,t){var n,o=r.length,a=(new Array(o*e),0),i=0,s=0,u=0,l=new Array(Math.ceil(o*e/t));for(s=0,l[0]=0;a<o;a++)for(i=0,n=r[a];i<e;i++,n>>>=1)s===t&&(l[++u]=0,s=0),l[u]+=(1&n)<<s++;return l}(t,u).reverse(),c=this.rModM.slice(0),f=Math.pow(2,u),y=T;for(y.length=f,y[0]=this.rModM,a=1;a<f;a++)y[a]=[],b(y[a-1],r,y[a]),this.reduce(y[a]);var h,g=[];for(a=0;a<l.length;a++){for(i=0;i<u;i++)this.montgomeryMultiply(c,c,c);h=l[a],o?g=y[h]:s(y,h,g),this.montgomeryMultiply(c,g,c)}return this.montgomeryMultiply(c,this.one,n),n},reduce:function(e,r){var t,n,o,a,i,s,c=this.m.length,f=[];for(r=r||e,t=[],b(e.slice(c-1),this.mu,t),n=t.slice(c+1),o=e.slice(0,c+1),b(n,l,a=[]),a=a.slice(0,c+1),o[c+1]=v(o,a)>>>31,i=0;i<r.length;i++)r[i]=0;E(o,a,r),s=+(v(r,l)>0),d.subtract(r,l,f),u(s,r,f),m(r)},ctx:n}}return{DIGIT_BITS:e,DIGIT_NUM_BYTES:r,DIGIT_MASK:t,DIGIT_BASE:n,DIGIT_MAX:o,Zero:u,One:l,normalizeDigitArray:m,bytesToDigits:h,stringToDigits:function(e,r){e=e.replace(/^\s+|\s+$/g,"");var t=[0],n=[0];r=r||10;for(var o=0;o<e.length;o+=1){var a=parseInt(e[o],r);if(isNaN(a))throw new Error("Failed to convert string to integer in radix "+r.toString());b(t,r,n),k(n,[a],t),m(t)}return t},digitsToString:function(e,r){if(n<=(r=r||10))throw new Error("DIGIT_BASE is smaller than RADIX; cannot convert.");var t,o=e.length,a=[],i=[],s=[],u=[],l=[],c=[],f="",y="0";for(l[0]=r;Math.floor(n/l[0])>=r;)l[0]=l[0]*r,y=y.concat("0");for(t=0;t<o;t+=1)c[t]=e[t];for(;;){var h=!0;for(t=0;t<c.length;t+=1)if(0!==c[t]){h=!1;break}if(h)break;x(c,l,a,i,s,u),m(a,c.length,!0);var g=i[0].toString(r);f=y.substring(0,y.length-g.length)+g+f;var p=c;c=a,a=p}for(;0!==f.length&&"0"===f[0];)f=f.substring(1,f.length);return 0===f.length&&(f="0"),f},intToDigits:g,digitsToBytes:function(e,t,n){var o,a,i,s=[0];for(void 0===t&&(t=!0),o=0;o<e.length;o+=1)for(i=e[o],a=0;a<r;a+=1)s[o*r+a]=255&i,i=Math.floor(i/256);if(s.reverse(),void 0===n&&(n=1),t)for(;s.length>n&&0===s[0];)s.shift();return s},isZero:y,isEven:function(e){return 0==(1&e[0])},shiftRight:function(r,n,o,a){if(void 0===o)o=1;else if(o>=e||o<0)throw new Error("Invalid bit count for shiftRight");void 0===a&&(a=r.length);for(var i=a-1,s=e-o,u=0;u<i;u++)n[u]=(r[u+1]<<s|r[u]>>>o)&t;n[i]=r[i]>>>o},shiftLeft:w,compareDigits:v,bitLength:function(e){for(var r=0,t=0;r<e.length;){if(0===t)for(var n=7;n>=0&&0===t;){var o=1<<n;(e[r]&o)===o&&(t=n+1),n--}else t+=8;r+=1}return t},fixedWindowRecode:function(e,r,t){e=e.slice();for(var n=[],o=Math.pow(2,r),a=Math.pow(2,r-1),i=0;i<t;i++)n[i]=e[0]%o-a,e[0]=e[0]-n[i],d.shiftRight(e,e,r-1);return n[i]=e[0],n},IntegerGroup:function(r){var n=h(r),o=n.length,a=g(0,o),i=g(1,o),s=c(o),u=c(o);function l(e,r){return{m_digits:e,m_group:r,equals:function(e){return 0===v(this.m_digits,e.m_digits)&&this.m_group.equals(this.m_group,e.m_group)}}}return{m_modulus:n,m_digitWidth:o,montmul:new D(n),createElementFromInteger:function(e){return l(g(e,this.m_digitWidth),this)},createElementFromBytes:function(e){var r=h(e);if(d.compareDigits(r,this.m_modulus)>=0)throw new Error("The number provided is not an element of this group");return m(r,this.m_digitWidth,!0),l(r,this)},createElementFromDigits:function(e){return d.normalizeDigitArray(e,this.m_digitWidth,!0),l(e,this)},equals:function(e){return 0===v(this.m_modulus,e.m_modulus)},add:function(r,n,o){var a,i=this.m_digitWidth,s=o.m_digits;d.add(r.m_digits,n.m_digits,s);var u=(v(s,this.m_modulus)>>>31)-1&t,l=0;for(a=0;a<i;a+=1)l=s[a]-(this.m_modulus[a]&u)+l,s[a]=l&t,l>>=e;s.length=i},subtract:function(r,n,o){var a,i=this.m_digitWidth,s=o.m_digits,u=d.subtract(r.m_digits,n.m_digits,o.m_digits);if(-1===u)for(u=0,a=0;a<i;a+=1)u+=s[a]+this.m_modulus[a],s[a]=u&t,u>>=e},multiply:function(e,r,t){return d.modMul(e.m_digits,r.m_digits,this.m_modulus,t.m_digits,s,u)},inverse:function(e,r){d.modInv(e.m_digits,this.m_modulus,r.m_digits)},modexp:function(e,r,t){if(t=t||l([],this),0===v(r,a))t.m_digits=g(1,this.m_digitWidth);else if(0===v(r,i)){for(var n=0;n<e.m_digits.length;n++)t.m_digits[n]=e.m_digits[n];t.m_digits.length=e.m_digits.length}else this.montmul.modExp(e.m_digits,r,t.m_digits),t.m_digits.length=this.montmul.s;return t}}},add:k,subtract:E,multiply:b,divRem:x,reduce:function(e,r,t,n,o){return x(e,r,[],t,n,o),t},modInv:function(e,r,t,n){var o=new Array(r.length),a=new Array(r.length),i=new Array(r.length),s=S(e,r,a,o,i);return t=t||[],0!==v(i,l)?(t[0]=NaN,t.length=1):(1==(1&s)?E(r,o,t):(f(o,0,t,0,o.length),t.length=o.length),n?m(t,r.length,!0):m(t)),t},modInvCT:function(e,r,t,n){var o=[];return t=t||[],E(r,[2],o),A(e,o,r,t),m(t),t},modExp:A,modMul:function(e,r,t,n,o,a){var i=[];return b(e,r,i),x(i,t,i,n,o,a),n},MontgomeryMultiplier:D,gcd:function(e,r,t){var n=e,o=r;return v(e,r)>0&&(n=r,o=e),S(n,o,void 0,void 0,t),m(t)},sequenceEqual:function(e,r){for(var t=e.length===r.length,n=0;n<Math.min(e.length,r.length);n+=1)e[n]!==r[n]&&(t=!1);return t},swapEndianness:function(e){return e.reverse()},computeBitArray:function(e){for(var r=c(8*e.length),t=0,n=e.length-1;n>=0;){for(var o=0;o<8;){var a=1<<o,i=(e[n]&a)===a?1:0,s=8*(e.length-n-1)+o;1===i&&(t=s+1),r[s]=i,o+=1}n--}return r.slice(0,t)}}}();var v=v||function(){var e=d.bytesToDigits;function r(e){var r,t=null;if(arguments.length&&"number"!=typeof arguments[0]){if("object"==typeof arguments[0])for(t=[],r=0;r<e.length;r+=1)t[r]=e[r]}else for(t=[],r=0;r<e;r+=1)t[r]=0;return t}var t=function(e,r,t,o,a,i){var s=e.length;return{p:e,a:r,b:t,order:o,generator:n(this,!1,a,i,null,!1),allocatePointStorage:function(){return n(this,!1,d.intToDigits(0,s),d.intToDigits(0,s))},createPointAtInfinity:function(){return n(this,!0,d.intToDigits(0,s),d.intToDigits(0,s))}}},n=function(e,t,o,a,i,s){var l;return void 0===i&&(i=null),void 0===s&&(s=!1),c(l={equals:function(e){return function(e){return!(!e||(!l.isInfinity||!e.isInfinity)&&(null===l.z&&null!==e.z||null!==l.z&&null===e.z||(null===l.z?0!==d.compareDigits(l.x,e.x)||0!==d.compareDigits(l.y,e.y)||l.isInMontgomeryForm!==e.isInMontgomeryForm:0!==d.compareDigits(l.x,e.x)||0!==d.compareDigits(l.y,e.y)||0!==d.compareDigits(l.z,e.z)||l.isInMontgomeryForm!==e.isInMontgomeryForm)))}(e)},copy:function(e){!function(e,r){if(r.curve=e.curve,r.x=e.x.slice(),r.y=e.y.slice(),null!==e.z?r.z=e.z.slice():r.z=null,u||(r.isAffine=e.isAffine),r.isInMontgomeryForm=e.isInMontgomeryForm,r.isInfinity=e.isInfinity,!r.equals(e))throw new Error("Instances should be equal.")}(this,e)},clone:function(){return e=n(l.curve,l.isInfinity,r(l.x),r(l.y),l.z?r(l.z):null,l.isInMontgomeryForm),l.ta&&(e.ta=r(l.ta)),l.tb&&(e.tb=r(l.tb)),e;var e}},"curve",e,function(){return e},function(r){e=r}),c(l,"x",o,function(){return o},function(e){o=e}),c(l,"y",a,function(){return a},function(e){a=e}),c(l,"z",i,function(){return i},function(e){i=e}),c(l,"isInMontgomeryForm",s,function(){return s},function(e){s=e}),c(l,"isInfinity",t,function(){return t},function(e){t=e}),c(l,"isAffine",null===i,function(){return null===i}),l},o=function(e){var t=1===e.type,n=e.p.length,o=d.MontgomeryMultiplier(e.p),a=e.a.slice();o.convertToMontgomeryForm(a);var s=d.isZero(e.a),l=d.One,c=r(n);c[0]=1,o.convertToMontgomeryForm(c);var f=d.IntegerGroup(d.digitsToBytes(o.m),!0),y=r(n),h=r(n),g=r(n),p=r(n),v=r(n),m=r(n),w=r(n),k=r(n),E=r(n),b=r(n),x=r(n),S=r(n);function A(e,r,t){var n=f.createElementFromInteger(0);n.m_digits=t,f.subtract(f.createElementFromDigits(e),f.createElementFromDigits(r),n)}function D(e,r,t){var n=f.createElementFromInteger(0);n.m_digits=t,f.add(f.createElementFromDigits(e),f.createElementFromDigits(r),n)}function T(r,t){var n=r.length,o=e.p;if(1==(1&r[0])){for(var a=0,i=0;i<n;i+=1)a+=r[i]+o[i],t[i]=a&d.DIGIT_MASK,a>>>=d.DIGIT_BITS;a<<=d.DIGIT_BITS-1,d.shiftRight(t,t),t[n-1]|=a}else d.shiftRight(r,t)}function I(e,r,t){o.montgomeryMultiply(e,r,t)}function M(e,r){o.montgomeryMultiply(e,e,r)}function C(e,r){var t=r.clone();if(F(t),!z(t))throw new Error("Invalid Parameter");var n=r.clone();O(n);var o,a=[r.clone()],i=n.clone(),s=n.clone();K(n,s),U(s);for(var u=1;u<Math.pow(2,e-2);u++)P(i,s,i),U(o=i.clone()),a[u]=o;return a}function K(e,r){if(void 0===e)throw new Error("point undefined");if(void 0===r)throw new Error("outputPoint undefined");if(e.isAffine)throw new Error("Given point was in Affine form. Use convertToJacobian() first.");if(!e.isInMontgomeryForm)throw new Error("Given point must be in Montgomery form. Use montgomeryize() first.");s?function(e,r){if(e.isInfinity)r.isInfinity=!0;else{M(e.y,p),M(e.x,v),D(v,v,y),D(y,v,v),I(e.x,p,m),M(p,y),T(v,h),M(h,p),I(e.y,e.z,E);for(var t=0;t<E.length;t+=1)r.z[t]=E[t];A(p,m,r.x),A(r.x,m,r.x),A(m,r.x,v),I(h,v,g),A(g,y,r.y),r.isInfinity=!1,r.isInMontgomeryForm=!0}}(e,r):function(e,r){e.isInfinity?r.isInfinity=!0:(M(e.z,h),I(e.z,e.y,v),D(e.x,h,g),A(e.x,h,h),r.z=v.slice(),I(h,g,p),T(p,g),D(p,g,h),M(e.y,g),M(h,v),I(e.x,g,p),A(v,p,v),A(v,p,r.x),A(p,r.x,v),M(g,p),I(h,v,g),A(g,p,r.y),r.isInfinity=!1,r.isInMontgomeryForm=!0)}(e,r)}function H(e,r,t){if(e.isInfinity)return r.copy(t),void this.convertToJacobianForm(t);if(r.isInfinity)e.copy(t);else{if(M(e.z,m),I(e.z,m,w),I(r.x,m,v),I(r.y,w,m),A(v,e.x,h),A(m,e.y,g),d.isZero(h))return d.isZero(g)?(K(e,t),void P(t,r,t)):(t.x=e.x.slice(0),t.y=e.y.slice(0),void(t.z=e.z.slice(0)));if(M(g,v),M(h,w),I(w,e.x,m),I(h,w,y),A(v,m,p),A(p,m,p),I(e.z,h,v),A(p,m,p),I(y,e.y,w),A(p,y,p),d.isZero(p)){for(i=0;i<t.x.length;i++)t.x[i]=0,t.y[i]=0,t.z[i]=0;t.y[0]=1}else D(w,w,h),I(v,p,t.z),I(g,p,v),M(p,y),D(h,v,h),I(y,m,v),M(h,k),I(y,p,m),A(k,v,t.x),A(t.x,v,t.x),A(t.x,m,t.x),A(t.x,v,p),I(m,w,y),I(h,p,v),A(v,y,t.y),t.isInfinity=!1,t.isInMontgomeryForm=!0}}function P(e,r,t){if(null===e)throw new Error("jacobianPoint");if(null===r)throw new Error("affinePoint");if(null===t)throw new Error("outputPoint");if(e.curve!==r.curve||e.curve!==t.curve)throw new Error("All points must be from the same curve object.");if(e.isAffine)throw new Error("Given jacobianPoint was in Affine form. Use ConvertToJacobian()                     before calling DoubleJacobianAddAffinePoints().");if(!r.isAffine)throw new Error("Given affinePoint was in Jacobian form. Use ConvertToAffine() before                      calling DoubleJacobianAddAffinePoints().");if(t.isAffine)throw new Error("Given jacobianPoint was in Jacobian form. Use ConvertToJacobian() before                      calling DoubleJacobianAddAffinePoints().");if(!e.isInMontgomeryForm)throw new Error("Jacobian point must be in Montgomery form");if(!r.isInMontgomeryForm)throw new Error("Affine point must be in Montgomery form");if(e.isInfinity)return r.copy(t),void this.convertToJacobianForm(t);if(r.isInfinity)e.copy(t);else{var o;for(M(e.z,h),I(h,e.z,g),I(h,r.x,p),I(g,r.y,v),A(p,e.x,h),A(v,e.y,g),o=0;o<h.length;o+=1)if(0!==h[o]){I(e.z,h,y);for(var a=0;a<n;a+=1)t.z[a]=y[a];return M(h,p),I(p,h,v),I(p,e.x,m),D(m,m,h),M(g,t.x),A(t.x,h,t.x),A(t.x,v,t.x),A(m,t.x,p),I(g,p,m),I(e.y,v,w),A(m,w,t.y),t.isInfinity=!1,void(t.isInMontgomeryForm=!0)}for(o=0;o<g.length;o+=1)if(0!==g[o])return t.isInfinity=!0,void(t.isInMontgomeryForm=!0);r.copy(t),this.convertToJacobianForm(t),this.double(t,t),t.isInMontgomeryForm=!0}}function B(r,t,o,a){if(t.isInfinity||d.isZero(r))o.isInfinity=!0;else{if(d.compareDigits(r,e.order)>=0)throw new Error("The scalar k must be in the range 1 <= k < order.");if(r=r.slice(),1===t.curve.type){var i=void 0!==t.ta;i||L(t),function(e,r,t,o){if(!G(r))throw new Error("Invalid Parameter");var a=r.curve.rbits;o=void 0===o||o;var i,s,u=n<=8?5:6,l=Math.floor((a+(u-2))/(u-1));e=e.slice();var c=r.clone();L(c),o&&(Q(c,c),Q(c,c));var f=q(1<<u-2,c),y=1&e[0],h=[];for(A(r.curve.order,e,h),i=0;i<e.length;i++)e[i]=y-1&(e[i]^h[i])^e[i];var g=d.fixedWindowRecode(e,u,l),p=Math.floor(Math.abs(g[l])-1)/2,v=f[p];for(c.x=v.x.slice(),c.y=v.y.slice(),c.z=v.z.slice(),i=l-1;i>=0;i--){for(s=0;s<u-1;s++)Q(c,c);p=Math.floor((Math.abs(g[i])-1)/2);var m=W(f,p),w=-(g[i]>>>31);A(r.curve.p,m.x,h);for(var k=0;k<m.x.length;k++)m.x[k]=m.x[k]&~w|h[k]&w;for(A(r.curve.p,m.td,h),k=0;k<m.td.length;k++)m.td[k]=m.td[k]&~w|h[k]&w;J(m,c,c)}for(A(r.curve.p,c.x,h),i=0;i<c.x.length;i++)c.x[i]=y-1&(c.x[i]^h[i])^c.x[i];j(c),t.x=c.x.slice(),t.y=c.y.slice()}(r,t,o,a),i||j(t)}else{var s=t.isInMontgomeryForm,u=o.isInMontgomeryForm,l=o.isAffine;s||R(t),u||R(o),function(e,r,t){var o=r.clone();if(F(o),!z(o))throw new Error("Invalid Parameters.");var a=1&e[0],i=[];for(A(r.curve.order,e,i),g=0;g<e.length;g++)e[g]=a-1&(e[g]^i[g])^e[g];var s=n<=8?5:6,u=r.curve.p.length*d.DIGIT_BITS,l=Math.ceil(u/(s-1)),c=d.fixedWindowRecode(e,s,l),f=C(s,r),y=Math.floor(Math.abs(c[l])-1)/2,h=f[y].clone();O(h);for(var g=l-1;g>=0;g--){for(var p=0;p<s-2;p++)K(h,h);y=Math.floor((Math.abs(c[g])-1)/2);var v=N(f,y);A(v.curve.p,v.y,i);for(var m=-(c[g]>>>31),w=0;w<v.y.length;w++)v.y[w]=v.y[w]&~m|i[w]&m;H(h,v,h)}for(A(r.curve.p,h.y,i),g=0;g<h.y.length;g++)h.y[g]=a-1&(h.y[g]^i[g])^h.y[g];h.copy(t)}(r,t,o),l&&U(o),s||F(t),u||F(o)}}}function N(e,r){for(var t,n,o=0;o<e.length;o++)t=+(o===r),n=[n,e[o].clone()][t];return n}function R(e){if(e.isInMontgomeryForm)throw new Error("The given point is already in Montgomery form.");e.isInfinity||(o.convertToMontgomeryForm(e.x),o.convertToMontgomeryForm(e.y),null!==e.z&&o.convertToMontgomeryForm(e.z),void 0!==e.ta&&(o.convertToMontgomeryForm(e.ta),o.convertToMontgomeryForm(e.tb))),e.isInMontgomeryForm=!0}function F(e){if(!e.isInMontgomeryForm)throw new Error("The given point is not in montgomery form.");e.isInfinity||(o.convertToStandardForm(e.x),o.convertToStandardForm(e.y),null!==e.z&&o.convertToStandardForm(e.z),void 0!==e.ta&&(o.convertToStandardForm(e.ta),o.convertToStandardForm(e.tb))),e.isInMontgomeryForm=!1}function U(r){if(r.isInfinity)return r.z=null,void(u||(r.isAffine=!0));if(d.modInv(r.z,e.p,S,!0),r.isInMontgomeryForm){I(S,o.rCubedModm,x);var t=S;S=x,x=t}M(S,b),I(r.x,b,x);for(var a=0;a<n;a+=1)r.x[a]=x[a];I(r.y,b,x),I(x,S,r.y),r.z=null,delete r.ta,delete r.tb,u||(r.isAffine=!0)}function O(e){if(!e.isAffine)throw new Error("The given point is not in Affine form.");u||(e.isAffine=!1);var t,n,o=e.isInMontgomeryForm?c:l;for(t=r(o.length),n=0;n<o.length;n+=1)t[n]=o[n];e.z=t}function z(e){return!e.isInfinity&&(d.modMul(e.y,e.y,e.curve.p,h),d.modMul(e.x,e.x,e.curve.p,g),d.modMul(e.x,g,e.curve.p,p),D(p,e.curve.b,g),d.modMul(e.x,e.curve.a,e.curve.p,p),D(g,p,g),A(h,g,h),!1!==d.isZero(h))}function G(e){return e.ta&&j(e=e.clone()),d.modMul(e.y,e.y,e.curve.p,p),d.modMul(e.x,e.x,e.curve.p,g),d.add(g,p,h),d.reduce(v,e.curve.p,v),d.modMul(g,p,e.curve.p,v),d.modMul(e.curve.d,v,e.curve.p,p),d.add(p,[1],g),d.reduce(g,e.curve.p,g),d.subtract(h,g,h),!1!==d.isZero(h)||(d.reduce(h,e.curve.p,h),!1!==d.isZero(h))}function q(e,r){var t=r.clone(),n=t.clone(),o=[];o[0]=V(r),Q(t,t),n=V(t),t=r.clone();for(var a=1;a<e;a++)J(n,t,t),o[a]=V(t);return o}function L(e){e.ta=e.x.slice(),e.tb=e.y.slice(),e.z=[1]}function W(e,r){for(var t=(r+1)%e.length,n=0;n<e.length;n++){var o={x:e[t].x.slice(),y:e[t].y.slice(),z:e[t].z.slice(),td:e[t].td.slice()};t=(t+1)%e.length}return o}function j(r){d.modInv(r.z,e.p,S,!0),d.modMul(r.x,S,e.p,r.x),d.modMul(r.y,S,e.p,r.y),delete r.ta,delete r.tb,r.z=null}function Q(e,r){if(void 0===e.ta)throw new Error("Point should be in Extended Projective form.");d.modMul(e.x,e.x,e.curve.p,y),d.modMul(e.y,e.y,e.curve.p,h),d.modMul(e.z,e.z,e.curve.p,e.ta),A(h,y,r.tb),D(y,h,y),D(e.ta,e.ta,e.ta),D(e.y,e.y,e.y),A(e.ta,y,h),d.modMul(e.x,e.y,e.curve.p,r.ta),d.modMul(y,r.tb,e.curve.p,r.y),d.modMul(h,r.ta,e.curve.p,r.x),d.modMul(y,h,e.curve.p,r.z)}function V(e){var r=e.curve,t=r.p,n={x:e.x.slice(),y:e.y.slice(),z:e.z.slice(),td:[],curve:e.curve};return d.modMul(e.ta,e.tb,t,b),d.modMul(b,r.d,t,n.td),n}function J(e,r,t){var n=d,o=r.curve.p;h=[],g=[],p=[],n.modMul(r.z,e.z,o,p),n.modMul(r.ta,r.tb,o,h),D(r.x,r.y,r.ta),n.modMul(h,e.td,o,g),D(e.x,e.y,r.tb),A(p,g,h),D(p,g,p),n.modMul(r.ta,r.tb,o,g),n.modMul(r.x,e.x,o,r.z),n.modMul(r.y,e.y,o,r.x),A(g,r.z,g),A(r.x,r.z,t.ta),A(g,r.x,t.tb),n.modMul(t.ta,p,o,t.y),n.modMul(t.tb,h,o,t.x),n.modMul(p,h,o,t.z)}var Z={convertToMontgomeryForm:R,convertToStandardForm:F,convertToAffineForm:U,convertToJacobianForm:O,generatePrecomputationTable:function(e,r){return C(e,r)}};return t?(Z.double=Q,Z.add=function(e,r,t){if(void 0===e.ta)throw new Error("Point1 should be in Extended Projective form.");if(void 0===r.ta)throw new Error("Point2 should be in Extended Projective form.");J(V(e),r,t)},Z.scalarMultiply=B,Z.normalize=j,Z.convertToExtendedProjective=L,Z.convertTedToWeierstrass=function(e,r){var t=e.curve.a.slice(),n=e.curve.d.slice(),o=e.curve.p,a=d.modMul,i=d.modInv;a(t,h=[5],o,g),A(g,n,g),a(n,h,o,p),A(t,p,h),a(e.y,h,o,p),D(p,g,g),A(h=[1],e.y,p),a(h=[12],p,o,v),i(v,o,v,!0),a(e.x,p,o,h),D(h,h,p),D(p,p,p),i(p,o,p,!0),a(v,g,o,r.x),h=[1],D(e.y,h,h),A(t,n,g),a(h,g,o,v),a(v,p,o,r.y)},Z.convertWeierstrassToTed=function(e,r){var t=r.curve.a.slice(),n=r.curve.d.slice(),o=r.curve.p,a=d.modMul,i=d.modInv;D(e.x,e.x,h),D(e.x,h,h),D(h,h,h),A(h,t,g),A(g,n,g),D(e.y,e.y,p),D(e.y,p,p),D(p,p,p),i(p,o,p,!0),a(g,p,o,r.x),D(h,h,h),D(h,n,g),D(h,t,h),D(t,t,p),A(g,p,g),A(g,p,g),A(g,t,g),D(n,n,p),A(h,p,h),A(h,p,h),A(h,n,h),i(h,o,h,!0),a(h,g,o,r.y)},Z.validatePoint=G,Z.generatePrecomputationTable=function(e,r){return q(e,r)}):(Z.double=K,Z.mixedDoubleAdd=H,Z.mixedAdd=P,Z.scalarMultiply=B,Z.negate=function(e,r){e!==r&&e.copy(r),A(e.curve.p,e.y,r.y)},Z.validatePoint=z),Z},a={},s=function(r){var n=a[r.toUpperCase()];if(!n)throw new Error(r+" Unsupported curve.");if(0===n.type)return function(r){var n=new t(e(r.p),e(r.a),e(r.b),e(r.order),e(r.gx),e(r.gy));return n.type=r.type,n.name=r.name,n.generator.curve=n,n}(n);if(1===n.type)return function(r){var n=new t(e(r.p),e(r.a),e(r.d),e(r.order),e(r.gx),e(r.gy));return n.type=r.type,1===n.type&&(n.d=n.b.slice(),delete n.b),n.rbits=r.info[2],n.name=r.name,n.generator.curve=n,n}(n);throw new Error(r+" Unsupported curve type.")};return{createCurve:s,curves:a,sec1EncodingFp:function(){return{encodePoint:function(e){if(!e)throw new Error("point");if(!e.isAffine)throw new Error("Point must be in affine form.");if(e.isInMontgomeryForm)throw new Error("Point must not be in Montgomery form.");if(e.isInfinity)return r(1);var t=d.digitsToBytes(e.x),n=d.digitsToBytes(e.y),o=d.digitsToBytes(e.curve.p).length;if(o<t.length||o<n.length)throw new Error("Point coordinate(s) are bigger than the field order.");var a=r(2*o+1);a[0]=4;for(var i=o-t.length,s=0;s<t.length;s++)a[s+1+i]=t[s];for(i=o-n.length,s=0;s<n.length;s++)a[o+s+1+i]=n[s];return a},decodePoint:function(e,t){if(e.length<1)throw new Error("Byte array must have non-zero length");var o=d.digitsToBytes(t.p).length;if(0===e[0]&&1===e.length)return t.createPointAtInfinity();if(4===e[0]&&e.length===1+2*o){for(var a=r(o),i=r(o),s=0;s<o;s++)a[s]=e[s+1],i[s]=e[o+s+1];var u=d.bytesToDigits(a),l=d.bytesToDigits(i);return n(t,!1,u,l)}throw new Error("Unsupported encoding format")}}},validatePoint:function(r,t,a,i){var u=s(r),l=new n(u,!1,e(t),e(a),i&&e(i),!1);return new o(u).validatePoint(l)},EllipticCurvePointFp:n,EllipticCurveOperatorFp:o,ModularSquareRootSolver:function(e){var r=e,t=[];if(void 0===e)throw new Error("modulus");if(d.isEven(e))throw new Error("Only odd moduli are supported");var n=d.MontgomeryMultiplier(r);r[0]%4==3?(d.add(r,d.One,t),d.shiftRight(t,t,2)):t=null;var o=new Array(r.length),a=new Array(r.length);return{squareRoot:function(e){if(null!==t)return function(e){var r=d.intToDigits(0,16);n.modExp(e,t,r);var o=[0];return d.modMul(r,r,n.m,o),0!==d.compareDigits(e,o)?null:r}(e);throw new Error("GeneralCase not supported.")},jacobiSymbol:function(e){var t,n;t=e.slice(),n=r.slice(),d.reduce(t,n,t,o,a);for(var i=1;!d.isZero(t);){for(;d.isEven(t);){d.shiftRight(t,t);var s=7&n[0];3!==s&&5!==s||(i=-i)}var u=t;t=n,n=u;var l=3&t[0],c=3&n[0];3===l&&3===c&&(i=-i),d.reduce(t,n,t,o,a)}return 0===d.compareDigits(n,d.One)?i:0}}}}}();void 0!==v&&(v.curves["P-256"]={name:"P-256",type:0,p:[255,255,255,255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255],a:[255,255,255,255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,252],b:[90,198,53,216,170,58,147,231,179,235,189,85,118,152,134,188,101,29,6,176,204,83,176,246,59,206,60,62,39,210,96,75],order:[255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81],gx:[107,23,209,242,225,44,66,71,248,188,230,229,99,164,64,242,119,3,125,129,45,235,51,160,244,161,57,69,216,152,194,150],gy:[79,227,66,226,254,26,127,155,142,231,235,74,124,15,158,22,43,206,51,87,107,49,94,206,203,182,64,104,55,191,81,245],cf:1},v.curves["P-384"]={name:"P-384",type:0,p:[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,255,255,0,0,0,0,0,0,0,0,255,255,255,255],a:[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,255,255,255,0,0,0,0,0,0,0,0,255,255,255,252],b:[179,49,47,167,226,62,231,228,152,142,5,107,227,248,45,25,24,29,156,110,254,129,65,18,3,20,8,143,80,19,135,90,198,86,57,141,138,46,209,157,42,133,200,237,211,236,42,239],order:[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,199,99,77,129,244,55,45,223,88,26,13,178,72,176,167,122,236,236,25,106,204,197,41,115],gx:[170,135,202,34,190,139,5,55,142,177,199,30,243,32,173,116,110,29,59,98,139,167,155,152,89,247,65,224,130,84,42,56,85,2,242,93,191,85,41,108,58,84,94,56,114,118,10,183],gy:[54,23,222,74,150,38,44,111,93,158,152,191,146,146,220,41,248,244,29,189,40,154,20,124,233,218,49,19,181,240,184,192,10,96,177,206,29,126,129,157,122,67,29,124,144,234,14,95],cf:1},v.curves["P-521"]={name:"P-521",type:0,p:[1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],a:[1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,252],b:[0,81,149,62,185,97,142,28,154,31,146,154,33,160,182,133,64,238,162,218,114,91,153,179,21,243,184,180,137,145,142,241,9,225,86,25,57,81,236,126,147,123,22,82,192,189,59,177,191,7,53,115,223,136,61,44,52,241,239,69,31,212,107,80,63,0],order:[1,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,81,134,135,131,191,47,150,107,127,204,1,72,247,9,165,208,59,181,201,184,137,156,71,174,187,111,183,30,145,56,100,9],gx:[0,198,133,142,6,183,4,4,233,205,158,62,203,102,35,149,180,66,156,100,129,57,5,63,181,33,248,40,175,96,107,77,61,186,161,75,94,119,239,231,89,40,254,29,193,39,162,255,168,222,51,72,179,193,133,106,66,155,249,126,126,49,194,229,189,102],gy:[1,24,57,41,106,120,154,59,192,4,92,138,95,180,44,125,27,217,152,245,68,73,87,155,68,104,23,175,189,23,39,62,102,44,151,238,114,153,94,244,38,64,197,80,185,1,63,173,7,97,53,60,112,134,162,114,194,64,136,190,148,118,159,209,102,80],cf:1});void 0!==v&&(v.curves["BN-254"]={name:"BN-254",type:0,p:[37,35,100,130,64,0,0,1,186,52,77,128,0,0,0,8,97,33,0,0,0,0,0,19,167,0,0,0,0,0,0,19],a:[0],b:[2],order:[37,35,100,130,64,0,0,1,186,52,77,128,0,0,0,7,255,159,128,0,0,0,0,16,161,0,0,0,0,0,0,13],gx:[37,35,100,130,64,0,0,1,186,52,77,128,0,0,0,8,97,33,0,0,0,0,0,19,167,0,0,0,0,0,0,18],gy:[1],cf:1});var m={info:["numsp256d1",256,256,256],type:0,p:[67,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[64,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),b:[129,85,2].reverse(),order:[37,168,81,71,41,32,171,32,96,92,38,234,117,130,60,228,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),gx:[177,172,26,178,30,238,82,188,58,199,212,3,9,155,87,131,9,203,66,79,160,149,122,41,97,219,170,90,182,214,158,188].reverse(),gy:[159,222,132,33,203,185,181,128,187,15,49,21,209,195,85,201,53,224,4,126,247,139,68,115,166,182,153,51,241,192,143,208].reverse(),cf:1},w={info:["numsp256t1",256,255,256],name:"numsp256t1",type:1,p:[67,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[1],d:[85,195,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),order:[245,74,221,238,144,177,71,26,155,67,89,47,165,90,149,65,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64].reverse(),gx:[218,19,237,46,144,192,222,160,134,53,8,227,14,138,57,12,214,155,32,105,95,61,30,205,125,35,234,106,251,20,117,138].reverse(),gy:[230,137,138,121,231,22,166,47,211,110,133,16,216,97,95,113,16,128,75,166,217,101,150,206,199,37,217,217,159,62,213,68].reverse(),cf:4},k={info:["numsp384d1",384,384,384],name:"numsp384d1",type:0,p:[195,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[192,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),b:[187,119,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),order:[185,97,14,123,246,129,77,96,122,226,55,76,61,157,218,190,129,104,93,235,30,175,30,214,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),gx:[42,21,152,32,4,186,156,235,123,196,97,15,16,237,46,82,66,199,108,42,27,41,189,243,244,249,129,251,205,193,37,2,166,241,5,65,34,202,128,72,28,24,111,177,240,86,121,117].reverse(),gy:[22,7,24,102,236,184,116,92,38,173,244,191,219,180,214,188,126,131,26,18,125,131,32,185,156,115,127,248,119,105,4,176,126,207,132,5,48,61,227,215,56,142,155,225,104,227,222,172].reverse(),cf:1},E={info:["numsp384t1",384,382,384],name:"numsp384t1",type:1,p:[195,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[1],d:[159,209,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),order:[125,137,163,230,196,220,185,32,121,200,53,171,90,85,228,97,207,225,107,180,28,26,71,226,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,63].reverse(),gx:[222,107,32,108,228,64,213,80,19,148,69,101,177,146,242,111,64,99,49,243,168,255,99,87,0,76,190,229,70,244,11,179,181,93,229,154,18,162,182,192,108,38,169,69,251,17,177,97].reverse(),gy:[146,147,114,240,225,3,141,157,220,72,236,70,249,176,114,0,75,150,69,246,247,152,15,131,86,95,66,241,116,130,173,22,215,13,177,35,164,177,56,135,176,238,166,185,103,62,152,130].reverse(),cf:4},b={info:["numsp512d1",512,512,512],name:"numsp512d1",type:0,p:[199,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[196,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),b:[155,217,1].reverse(),order:[93,85,51,4,57,63,21,206,67,210,124,96,54,139,86,59,198,189,208,151,237,88,194,79,27,131,231,148,251,164,60,91,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),gx:[87,174,171,140,149,135,130,220,226,93,111,125,19,96,93,29,131,21,86,37,134,66,121,147,158,53,107,7,81,161,33,80,249,217,6,83,194,224,6,69,133,246,1,181,59,216,202,152,82,59,61,160,2,112,43,218,147,10,29,20,71,52,192,58].reverse(),gy:[166,39,53,56,96,135,160,35,233,15,253,76,30,92,43,207,2,86,90,178,64,168,33,193,233,237,14,139,218,21,132,162,20,79,209,123,12,38,75,143,140,187,188,171,222,219,151,75,0,177,235,99,220,238,14,206,179,86,173,41,202,84,58,148].reverse(),cf:4},x={info:["numsp512t1",512,510,512],name:"numsp512t1",type:1,p:[199,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),a:[1].reverse(),d:[239,203,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255].reverse(),order:[109,212,238,27,245,140,70,103,255,236,239,109,120,5,70,42,245,134,182,112,201,216,63,158,186,145,207,47,109,99,240,180,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,63].reverse(),gx:[254,87,236,153,41,171,185,197,21,240,196,124,66,37,229,15,173,4,137,86,146,201,189,120,15,115,70,238,78,193,33,70,71,129,59,39,190,126,161,39,130,163,196,77,159,231,209,47,51,197,211,136,120,203,24,122,156,182,141,18,109,49,142,223].reverse(),gy:[225,245,226,193,192,222,109,50,31,208,241,155,138,211,102,2,253,193,236,42,134,6,26,96,98,53,150,233,242,83,202,32,65,131,158,144,149,107,43,169,34,157,37,216,38,247,118,228,110,37,42,168,119,245,176,152,113,202,73,157,243,191,9,109].reverse(),cf:4};void 0!==v&&(v.curves.NUMSP256D1=m,v.curves.NUMSP384D1=k,v.curves.NUMSP512D1=b,v.curves.NUMSP256T1=w,v.curves.NUMSP384T1=E,v.curves.NUMSP512T1=x);var S=function(e,r,t,n,o,a,i){var s=y,u=t.slice(),l=new Array(o),c=[],f=0;function h(e){for(var r=Math.floor(e.length/o),t=0;t<r;t++)a(e,t,u,n,l);return f+=r,e.slice(r*o)}function g(){if(0!==h(function(e){var r=o-e.length%o;r<=o/8&&(r+=o);var t=s.getVector(r);t[0]=128;for(var n=8*(e.length+f*o),a=1;a<=8;a++)t[r-a]=n%256,n=Math.floor(n/256);return e.concat(t)}(c)).length)throw new Error("buffer.length !== 0");var e=function(){for(var e=[],r=0;r<u.length;r++)e=e.concat(s.int32ToBytes(u[r]));return e.length=i/8,e}();return c=[],u=t.slice(),f=0,e}return{name:e,computeHash:function(e){return c=h(e),g()},process:function(e){(c=c.concat(e)).length>=o&&(c=h(c))},finish:g,der:r,hashLen:i,maxMessageSize:4294967295}},A=function(){function e(e,t,n,o,a){var i,s,u,l,c=4294967295,f=n[0],y=n[1],h=n[2],g=n[3],p=n[4];for(s=0;s<16;s++)a[s]=r.bytesToInt32(e,64*t+4*s);for(i=16;i<80;i++)l=a[i-3]^a[i-8]^a[i-14]^a[i-16],a[i]=l<<1|l>>>31;for(s=0;s<80;s++)u=f<<5|f>>>27,u+=s>=60?y^h^g:s>=40?y&h^y&g^h&g:s>=20?y^h^g:y&h^~y&g,u+=p+o[s]+a[s],p=g,g=h,h=y<<30|y>>>2,y=f,f=u;return n[0]+=f&c,n[1]+=y&c,n[2]+=h&c,n[3]+=g&c,n[4]+=p&c,n}var r=y,t=r.unpackData,n=t("Z0UjAe/Nq4mYutz+EDJUdsPS4fA=",4,1),o=t("WoJ5mVqCeZlagnmZWoJ5mVqCeZlagnmZWoJ5mVqCeZlagnmZWoJ5mVqCeZlagnmZWoJ5mVqCeZlagnmZWoJ5mVqCeZlagnmZWoJ5mVqCeZlu2euhbtnroW7Z66Fu2euhbtnroW7Z66Fu2euhbtnroW7Z66Fu2euhbtnroW7Z66Fu2euhbtnroW7Z66Fu2euhbtnroW7Z66Fu2euhbtnroY8bvNyPG7zcjxu83I8bvNyPG7zcjxu83I8bvNyPG7zcjxu83I8bvNyPG7zcjxu83I8bvNyPG7zcjxu83I8bvNyPG7zcjxu83I8bvNyPG7zcymLB1spiwdbKYsHWymLB1spiwdbKYsHWymLB1spiwdbKYsHWymLB1spiwdbKYsHWymLB1spiwdbKYsHWymLB1spiwdbKYsHWymLB1spiwdY",4,1),a=t("MCEwCQYFKw4DAhoFAAQU");return{sha1:function(){return S("SHA-1",a,n,o,64,e,160)}}}();void 0!==r&&(A.instances={},A.getInstance=function(e){return A.instances[e]||(A.instances[e]=A.sha1())},A.deleteInstance=function(e){A.instances[e]=null,delete A.instances[e]},A.hash=function(e){if("process"!==e.operationSubType)return"finish"===e.operationSubType?A.sha1.finish():A.sha1().computeHash(e.buffer);A.sha1.process(e.buffer)},r.register("digest","SHA-1",A.hash)),f["SHA-1"]=A.sha1;var D=function(){var e=y;function r(r,t,n,o,a){var i,s,u,l,c,f=n[0],y=n[1],h=n[2],g=n[3],p=n[4],d=n[5],v=n[6],m=n[7];for(s=0;s<16;s++)a[s]=e.bytesToInt32(r,64*t+4*s);for(i=16;i<64;i++)l=a[i-15],c=a[i-2],a[i]=((c>>>17|c<<15)^(c>>>19|c<<13)^c>>>10)+a[i-7]+((l>>>7|l<<25)^(l>>>18|l<<14)^l>>>3)+a[i-16],a[i]=4294967295&a[i];for(s=0;s<64;s++)g+=u=m+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&d^~p&v)+o[s]+a[s],u+=((f>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10))+(f&(y^h)^y&h),m=v,v=d,d=p,p=g,g=h,h=y,y=f,f=u;return n[0]=n[0]+f>>>0,n[1]=n[1]+y>>>0,n[2]=n[2]+h>>>0,n[3]=n[3]+g>>>0,n[4]=n[4]+p>>>0,n[5]=n[5]+d>>>0,n[6]=n[6]+v>>>0,n[7]=n[7]+m>>>0,n}var t,n,o,a,i,s=e.unpackData;return n=s("wQWe2DZ81QcwcN0X9w5ZOf/ACzFoWBURZPmPp776T6Q",4,1),o=s("agnmZ7tnroU8bvNypU/1OlEOUn+bBWiMH4PZq1vgzRk",4,1),t=s("QoovmHE3RJG1wPvP6bXbpTlWwltZ8RHxkj+CpKscXtXYB6qYEoNbASQxhb5VDH3Dcr5ddIDesf6b3AanwZvxdOSbacHvvkeGD8GdxiQMocwt6SxvSnSEqlywqdx2+YjamD5RUqgxxm2wAyfIv1l/x8bgC/PVp5FHBspjURQpKWcntwqFLhshOE0sbfxTOA0TZQpzVHZqCruBwskuknIshaK/6KGoGmZLwkuLcMdsUaPRkugZ1pkGJPQONYUQaqBwGaTBFh43bAgnSHdMNLC8tTkcDLNO2KpKW5zKT2gub/N0j4LueKVjb4TIeBSMxwIIkL7/+qRQbOu++aP3xnF48g",4,1),a=s("MC0wDQYJYIZIAWUDBAIEBQAEHA"),i=s("MDEwDQYJYIZIAWUDBAIBBQAEIA"),{sha224:function(){return S("SHA-224",a,n,t,64,r,224)},sha256:function(){return S("SHA-256",i,o,t,64,r,256)}}}();void 0!==r&&(D.instance224=D.instance224||D.sha224(),D.instance256=D.instance256||D.sha256(),D.instances={},D.getInstance224=function(e){return D.instances[e]||(D.instances[e]=D.sha224())},D.getInstance256=function(e){return D.instances[e]||(D.instances[e]=D.sha256())},D.deleteInstance=function(e){D.instances[e]=null,delete D.instances[e]},D.hash256=function(e){if("process"===e.operationSubType)return D.getInstance256(e.workerid).process(e.buffer),null;if("finish"===e.operationSubType){var r=D.getInstance256(e.workerid).finish();return D.deleteInstance(e.workerid),r}if("abort"!==e.operationSubType)return D.instance256.computeHash(e.buffer);D.deleteInstance(e.workerid)},D.hash224=function(e){if("process"!==e.operationSubType){if("finish"===e.operationSubType&&D.getInstance224(e.workerid).finish(),"abort"!==e.operationSubType)return D.instance224.computeHash(e.buffer);msrcryptoSha224.deleteInstance(e.workerid)}else D.getInstance224(e.workerid).process(e.buffer)},r.register("digest","SHA-224",D.hash224),r.register("digest","SHA-256",D.hash256)),f["SHA-224"]=D.sha224,f["SHA-256"]=D.sha256;var T=function(){function e(e,r,t,n,o){var a=r+n|0,i=a>>>0<n>>>0;o[0]=e+t+i|0,o[1]=a}function r(r,t,n,o,a){var i,s,u,l,c,f,y,h,g,p=[],d=[],v=[],m=n[0],w=n[1],k=n[2],E=n[3],b=n[4],x=n[5],S=n[6],A=n[7],D=n[8],T=n[9],I=n[10],M=n[11],C=n[12],K=n[13],H=n[14],P=n[15];for(i=0;i<32;i++)g=128*t+4*i,a[i]=r.slice(g,g+4),a[i]=a[i][0]<<24|a[i][1]<<16|a[i][2]<<8|a[i][3];for(i=32;i<160;i+=2)u=((y=a[i-30])>>>1|(h=a[i-29])<<31)^(y>>>8|h<<24)^y>>>7,l=(h>>>1|y<<31)^(h>>>8|y<<24)^(h>>>7|y<<25),e(c=((y=a[i-4])>>>19|(h=a[i-3])<<13)^(h>>>29|y<<3)^y>>>6,f=(h>>>19|y<<13)^(y>>>29|h<<3)^(h>>>6|y<<26),a[i-14],a[i-13],p),e(u,l,p[0],p[1],p),e(a[i-32],a[i-31],p[0],p[1],p),a[i]=p[0],a[i+1]=p[1];for(s=0;s<160;s+=2)c=D&I^C&~D,f=T&M^K&~T,e(H,P,u=(D>>>14|T<<18)^(D>>>18|T<<14)^(T>>>9|D<<23),l=(T>>>14|D<<18)^(T>>>18|D<<14)^(D>>>9|T<<23),p),e(c,f,o[s],o[s+1],d),e(p[0],p[1],a[s],a[s+1],v),e(d[0],d[1],v[0],v[1],v),e(v[0],v[1],S,A,p),S=p[0],A=p[1],f=w&(E^x)^E&x,c=m&(k^b)^k&b,e(v[0],v[1],u=(m>>>28|w<<4)^(w>>>2|m<<30)^(w>>>7|m<<25),l=(w>>>28|m<<4)^(m>>>2|w<<30)^(m>>>7|w<<25),p),e(c,f,u=p[0],l=p[1],p),H=C,P=K,C=I,K=M,I=D,M=T,D=S,T=A,S=b,A=x,b=k,x=E,k=m,E=w,m=u=p[0],w=l=p[1];return e(n[0],n[1],m,w,p),n[0]=p[0],n[1]=p[1],e(n[2],n[3],k,E,p),n[2]=p[0],n[3]=p[1],e(n[4],n[5],b,x,p),n[4]=p[0],n[5]=p[1],e(n[6],n[7],S,A,p),n[6]=p[0],n[7]=p[1],e(n[8],n[9],D,T,p),n[8]=p[0],n[9]=p[1],e(n[10],n[11],I,M,p),n[10]=p[0],n[11]=p[1],e(n[12],n[13],C,K,p),n[12]=p[0],n[13]=p[1],e(n[14],n[15],H,P,p),n[14]=p[0],n[15]=p[1],n}var t,n,o,a,i,s,u,l=y.unpackData;return t=l("y7udXcEFnthimikqNnzVB5FZAVowcN0XFS/s2PcOWTlnMyZn/8ALMY60SodoWBUR2wwuDWT5j6dHtUgdvvpPpA==",4,1),n=l("agnmZ/O8yQi7Z66FhMqnOzxu83L+lPgrpU/1Ol8dNvFRDlJ/reaC0ZsFaIwrPmwfH4PZq/tBvWtb4M0ZE34heQ",4,1),o=l("QoovmNcoriJxN0SRI+9lzbXA+8/sTTsv6bXbpYGJ27w5VsJb80i1OFnxEfG2BdAZkj+CpK8ZT5urHF7V2m2BGNgHqpijAwJCEoNbAUVwb74kMYW+TuSyjFUMfcPV/7Ticr5ddPJ7iW+A3rH+OxaWsZvcBqclxxI1wZvxdM9pJpTkm2nBnvFK0u++R4Y4TyXjD8GdxouM1bUkDKHMd6ycZS3pLG9ZKwJ1SnSEqm6m5INcsKncvUH71Hb5iNqDEVO1mD5RUu5m36uoMcZtLbQyELADJ8iY+yE/v1l/x77vDuTG4AvzPaiPwtWnkUeTCqclBspjUeADgm8UKSlnCg5ucCe3CoVG0i/8LhshOFwmySZNLG38WsQq7VM4DROdlbPfZQpzVIuvY952agq7PHeyqIHCyS5H7a7mknIshRSCNTuiv+ihTPEDZKgaZku8QjABwkuLcND4l5HHbFGjBlS+MNGS6BnW71IY1pkGJFVlqRD0DjWFV3EgKhBqoHAyu9G4GaTBFrjS0MgeN2wIUUGrUydId0zfjuuZNLC8teGbSKg5HAyzxclaY07YqkrjQYrLW5zKT3dj43NoLm/z1rK4o3SPgu5d77L8eKVjb0MXL2CEyHgUofCrcozHAggaZDnskL7/+iNjHiikUGzr3oK96b75o/eyxnkVxnF48uNyUyvKJz7O6iZhnNGGuMchwMIH6tp91s3g6x71fU9/7m7ReAbwZ6pyF2+6CmN9xaLImKYRP5gEvvkNrhtxCzUTHEcbKNt39SMEfYQyyqt7QMckkzyevgoVyb68Qx1nxJwQDUxMxdS+yz5Ctll/KZz8ZX4qX8tvqzrW+uxsRBmMSkdYFw==",4,1),a=l("MEEwDQYJYIZIAWUDBAICBQAEMA"),i=l("MFEwDQYJYIZIAWUDBAIDBQAEQA"),s=l("MC0wDQYJYIZIAWUDBAIFBQAEHA"),u=l("MDEwDQYJYIZIAWUDBAIGBQAEIA"),{sha384:function(){return S("SHA-384",a,t,o,128,r,384)},sha512:function(){return S("SHA-512",i,n,o,128,r,512)},sha512_224:function(){return S("SHA-512.224",s,n,o,128,r,224)},sha512_256:function(){return S("SHA-512.256",u,n,o,128,r,256)}}}();void 0!==r&&(T.instances={},T.getInstance384=function(e){return T.instances[e]||(T.instances[e]=T.sha384())},T.getInstance512=function(e){return T.instances[e]||(T.instances[e]=T.sha512())},T.deleteInstance=function(e){T.instances[e]=null,delete T.instances[e]},T.hash384=function(e){if("process"!==e.operationSubType)return"finish"===e.operationSubType?T.sha384.finish():T.sha384().computeHash(e.buffer);T.sha384.process(e.buffer)},T.hash512=function(e){if("process"!==e.operationSubType)return"finish"===e.operationSubType?T.sha512.finish():T.sha512().computeHash(e.buffer);T.sha512.process(e.buffer)},r.register("digest","SHA-384",T.hash384),r.register("digest","SHA-512",T.hash512)),f["SHA-384"]=T.sha384,f["SHA-512"]=T.sha512;var I=function(e,r){var t,n,o,a,i,s={384:128,512:128}[r.name.replace(/SHA-/,"")]||64,u=e.length===s?e:e.length>s?c(r.computeHash(e),s):c(e,s);function l(e,r){for(var t=new Array(e),n=0;n<e.length;n++)t[n]=e[n]^r[n];return t}function c(e,r){for(var t=e.slice(),n=e.length;n<r;n++)t.push(0);return t}function f(e){i?r.process(e):(i=a.concat(e),r.process(i))}function y(){var e=r.finish(),t=o.concat(e);return r.computeHash(t)}function h(){e=null,r=null,u=null}t=new Array(s),n=new Array(s);for(var g=0;g<s;g++)t[g]=54,n[g]=92;return a=l(u,t),o=l(u,n),{computeHmac:function(e,r,t){f(e);var n=y();return h(),n},process:function(e,r,t){return f(e),null},finish:function(e,r){var t=y();return h(),t}}};if(void 0!==r){var M={};I.signHmac=function(e){var r,t=e.keyHandle.algorithm.hash.name.toUpperCase(),n=f[t](),o=e.workerid;return M[o]||(M[o]=I(e.keyData,n)),"process"===e.operationSubType?(M[o].process(e.buffer),null):"finish"===e.operationSubType?(r=M[o].finish(),M[o]=null,r):(r=M[o].computeHmac(e.buffer),M[o]=null,r)},I.verifyHmac=function(e){var r,t=e.keyHandle.algorithm.hash.name.toUpperCase(),n=f[t](),o=e.workerid;return M[o]||(M[o]=I(e.keyData,n)),"process"===e.operationSubType?(M[o].process(e.buffer),null):"finish"===e.operationSubType?(r=M[o].finish(),r=y.arraysEqual(r,e.signature),M[o]=null,r):(r=M[o].computeHmac(e.buffer),r=y.arraysEqual(r,e.signature),M[o]=null,r)},I.generateKey=function(e){var r=e.algorithm.length;return r||(r={"SHA-1":64,"SHA-224":64,"SHA-256":64,"SHA-384":128,"SHA-512":128}[e.algorithm.hash.name.toUpperCase()]),{type:"keyGeneration",keyData:Z.getBytes(r),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},I.importKey=function(e){var r;if(e.keyData.length,"jwk"===e.format)(r=p.jwkToKey(e.keyData,e.algorithm,["k"])).alg=r.alg.replace("HS","SHA-");else{if("raw"!==e.format)throw new Error("unsupported import format");r={k:y.toArray(e.keyData)}}return{type:"keyImport",keyData:r.k,keyHandle:{algorithm:{name:"HMAC",hash:{name:e.algorithm.hash.name}},extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"}}},I.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new Error("unsupported export format")},r.register("importKey","HMAC",I.importKey),r.register("exportKey","HMAC",I.exportKey),r.register("generateKey","HMAC",I.generateKey),r.register("sign","HMAC",I.signHmac),r.register("verify","HMAC",I.verifyHmac)}var C,K,H,P,B,N,R,F,U,O,z={aes:function(e){var r,t,n,o;switch(C||(C=y.unpackData("AAIEBggKDA4QEhQWGBocHiAiJCYoKiwuMDI0Njg6PD5AQkRGSEpMTlBSVFZYWlxeYGJkZmhqbG5wcnR2eHp8foCChIaIioyOkJKUlpianJ6goqSmqKqsrrCytLa4ury+wMLExsjKzM7Q0tTW2Nrc3uDi5Obo6uzu8PL09vj6/P4bGR8dExEXFQsJDw0DAQcFOzk/PTMxNzUrKS8tIyEnJVtZX11TUVdVS0lPTUNBR0V7eX99c3F3dWtpb21jYWdlm5mfnZORl5WLiY+Ng4GHhbu5v72zsbe1q6mvraOhp6Xb2d/d09HX1cvJz83DwcfF+/n//fPx9/Xr6e/t4+Hn5QADBgUMDwoJGBseHRQXEhEwMzY1PD86OSgrLi0kJyIhYGNmZWxvaml4e359dHdycVBTVlVcX1pZSEtOTURHQkHAw8bFzM/Kydjb3t3U19LR8PP29fz/+vno6+7t5Ofi4aCjpqWsr6qpuLu+vbS3srGQk5aVnJ+amYiLjo2Eh4KBm5idnpeUkZKDgIWGj4yJiquora6npKGis7C1tr+8ubr7+P3+9/Tx8uPg5ebv7Onqy8jNzsfEwcLT0NXW39zZ2ltYXV5XVFFSQ0BFRk9MSUpraG1uZ2RhYnNwdXZ/fHl6Ozg9Pjc0MTIjICUmLywpKgsIDQ4HBAECExAVFh8cGRoADhwSODYkKnB+bGJIRlRa4O788tjWxMqQnoyCqKa0utvVx8nj7f/xq6W3uZOdj4E7NScpAw0fEUtFV1lzfW9hraOxv5WbiYfd08HP5ev5901DUV91e2lnPTMhLwULGRd2eGpkTkBSXAYIGhQ+MCIslpiKhK6gsrzm6Pr03tDCzEFPXVN5d2VrMT8tIwkHFRuhr72zmZeFi9HfzcPp5/X7mpSGiKKsvrDq5Pb40tzOwHp0ZmhCTF5QCgQWGDI8LiDs4vD+1NrIxpySgI6kqri2DAIQHjQ6KCZ8cmBuREpYVjc5KyUPARMdR0lbVX9xY23X2cvF7+Hz/aepu7WfkYONAA0aFzQ5LiNoZXJ/XFFGS9Ddysfk6f7zuLWir4yBlpu7tqGsj4KVmNPeycTn6v3wa2ZxfF9SRUgDDhkUNzotIG1gd3pZVENOBQgfEjE8Kya9sKeqiYSTntXYz8Lh7Pv21tvMweLv+PW+s6SpioeQnQYLHBEyPyglbmN0eVpXQE3a18DN7uP0+bK/qKWGi5yRCgcQHT4zJClib3h1VltMQWFse3ZVWE9CCQQTHj0wJyqxvKumhYifktnUw87t4Pf6t7qtoIOOmZTf0sXI6+bx/GdqfXBTXklEDwIVGDs2ISwMARYbODUiL2RpfnNQXUpH3NHGy+jl8v+0ua6jgI2alwALFh0sJzoxWFNORXR/Ymmwu6atnJeKgejj/vXEz9LZe3BtZldcQUojKDU+DwQZEsvA3dbn7PH6k5iFjr+0qaL2/eDr2tHMx66luLOCiZSfRk1QW2phfHceFQgDMjkkL42Gm5Chqre81d7DyPny7+Q9NisgERoHDGVuc3hJQl9U9/zh6tvQzcavpLmyg4iVnkdMUVprYH12HxQJAjM4JS6Mh5qRoKu2vdTfwsn48+7lPDcqIRAbBg1kb3J5SENeVQEKFxwtJjswWVJPRHV+Y2ixuqesnZaLgOni//TFztPYenFsZ1ZdQEsiKTQ/DgUYE8rB3Nfm7fD7kpmEj761qKMACRIbJC02P0hBWlNsZX53kJmCi7S9pq/Y0crD/PXu5zsyKSAfFg0Ec3phaFdeRUyrormwj4adlOPq8fjHztXcdn9kbVJbQEk+NywlGhMIAebv9P3Cy9DZrqe8tYqDmJFNRF9WaWB7cgUMFx4hKDM63dTPxvnw6+KVnIeOsbijquzl/vfIwdrTpK22v4CJkpt8dW5nWFFKQzQ9Ji8QGQIL197FzPP64eiflo2Eu7KpoEdOVVxjanF4DwYdFCsiOTCak4iBvrespdLbwMn2/+TtCgMYES4nPDVCS1BZZm90faGos7qFjJee6eD78s3E39YxOCMqFRwHDnlwa2JdVE9GY3x3e/Jrb8UwAWcr/terdsqCyX36WUfwrdSir5ykcsC3/ZMmNj/3zDSl5fFx2DEVBMcjwxiWBZoHEoDi6yeydQmDLBobblqgUjvWsynjL4RT0QDtIPyxW2rLvjlKTFjP0O+q+0NNM4VF+QJ/UDyfqFGjQI+SnTj1vLbaIRD/89LNDBPsX5dEF8Snfj1kXRlzYIFP3CIqkIhG7rgU3l4L2+AyOgpJBiRcwtOsYpGV5HnnyDdtjdVOqWxW9Opleq4IunglLhymtMbo3XQfS72LinA+tWZIA/YOYTVXuYbBHZ7h+JgRadmOlJseh+nOVSjfjKGJDb/mQmhBmS0PsFS7FlIJatUwNqU4v0CjnoHz1/t84zmCmy//hzSOQ0TE3unLVHuUMqbCIz3uTJULQvrDTgguoWYo2SSydluiSW2L0SVy+PZkhmiYFtSkXMxdZbaSbHBIUP3tudpeFUZXp42dhJDYqwCMvNMK9+RYBbizRQbQLB6Pyj8PAsGvvQMBE4prOpERQU9n3OqX8s/O8LTmc5asdCLnrTWF4vk36Bx1325H8RpxHSnFiW+3Yg6qGL4b/FY+S8bSeSCa28D+eM1a9B/dqDOIB8cxsRIQWSeA7F9gUX+pGbVKDS3lep+TyZzvoOA7Ta4q9bDI67s8g1OZYRcrBH66d9Ym4WkUY1UhDH2NAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuNAQIECBAgQIAbNmzYq02aL168Y8aXNWrUs33678WROXLk071hwp8lSpQzZsyDHTp06MuN",256,!1),K=C[0],H=C[1],P=C[2],B=C[3],N=C[4],R=C[5],F=C[6],U=C[7],O=C[8]),r=8*e.length){case 128:case 192:case 256:break;default:throw new Error("Unsupported keyLength")}n=6+(t=r/32);var a=function(e){var r=e[1];e[1]=e[5],e[5]=e[9],e[9]=e[13],e[13]=r,r=e[2],e[2]=e[10],e[10]=r,r=e[6],e[6]=e[14],e[14]=r,r=e[15],e[15]=e[11],e[11]=e[7],e[7]=e[3],e[3]=r},i=function(e){var r=e[13];e[13]=e[9],e[9]=e[5],e[5]=e[1],e[1]=r,r=e[10],e[10]=e[2],e[2]=r,r=e[14],e[14]=e[6],e[6]=r,r=e[3],e[3]=e[7],e[7]=e[11],e[11]=e[15],e[15]=r},s=function(e){var r=e[0],t=e[1],n=e[2],o=e[3],a=e[4],i=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],y=e[11],h=e[12],g=e[13],p=e[14],d=e[15];e[0]=K[r]^H[t]^n^o,e[1]=r^K[t]^H[n]^o,e[2]=r^t^K[n]^H[o],e[3]=H[r]^t^n^K[o],e[4]=K[a]^H[i]^s^u,e[5]=a^K[i]^H[s]^u,e[6]=a^i^K[s]^H[u],e[7]=H[a]^i^s^K[u],e[8]=K[l]^H[c]^f^y,e[9]=l^K[c]^H[f]^y,e[10]=l^c^K[f]^H[y],e[11]=H[l]^c^f^K[y],e[12]=K[h]^H[g]^p^d,e[13]=h^K[g]^H[p]^d,e[14]=h^g^K[p]^H[d],e[15]=H[h]^g^p^K[d]},u=function(e){var r=e[0],t=e[1],n=e[2],o=e[3],a=e[4],i=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],y=e[11],h=e[12],g=e[13],p=e[14],d=e[15];e[0]=P[r]^N[t]^B[n]^R[o],e[1]=R[r]^P[t]^N[n]^B[o],e[2]=B[r]^R[t]^P[n]^N[o],e[3]=N[r]^B[t]^R[n]^P[o],e[4]=P[a]^N[i]^B[s]^R[u],e[5]=R[a]^P[i]^N[s]^B[u],e[6]=B[a]^R[i]^P[s]^N[u],e[7]=N[a]^B[i]^R[s]^P[u],e[8]=P[l]^N[c]^B[f]^R[y],e[9]=R[l]^P[c]^N[f]^B[y],e[10]=B[l]^R[c]^P[f]^N[y],e[11]=N[l]^B[c]^R[f]^P[y],e[12]=P[h]^N[g]^B[p]^R[d],e[13]=R[h]^P[g]^N[p]^B[d],e[14]=B[h]^R[g]^P[p]^N[d],e[15]=N[h]^B[g]^R[p]^P[d]},l=function(e,r){return[e[0]^r[0],e[1]^r[1],e[2]^r[2],e[3]^r[3]]},c=function(e,r,t){for(var n=0;n<e.length;n+=1)e[n]^=r[n+t]},f=function(e){for(var r=0;r<e.length;r+=1)e[r]=F[e[r]]},h=function(e){for(var r=0;r<e.length;r+=1)e[r]=U[e[r]]},g=function(e,r){return[e[4*r],e[4*r+1],e[4*r+2],e[4*r+3]]};return o=function(e){for(var r,o,a,i,s,u,c,y=[],h=0;h<4*t;)y.push(e[h++]);for(h=t;h<4*(n+1);){if(r=g(y,h-1),h%t==0){var p=[O[h/t],0,0,0];c=void 0,c=(u=r)[0],u[0]=u[1],u[1]=u[2],u[2]=u[3],u[3]=c,f(r),r=l(r,p)}else t>6&&h%t==4&&f(r);var d=l(g(y,h-t),r);a=d,s=0,(o=y)[4*(i=h)]=a[4*s],o[4*i+1]=a[4*s+1],o[4*i+2]=a[4*s+2],o[4*i+3]=a[4*s+3],h+=1}return y}(e),{encrypt:function(e){var r,t=e;for(c(t,o,0),r=1;r<=n-1;r+=1)f(t),a(t),s(t),c(t,o,4*r*4);return f(t),a(t),c(t,o,4*n*4),t},decrypt:function(e){var r,t=e;for(c(t,o,4*n*4),r=n-1;r>=1;r-=1)i(t),h(t),c(t,o,4*r*4),u(t);return i(t),h(t),c(t,o,0),t},clear:function(){},keyLength:r,blockSize:128}}},G=G||{};G.pkcsv7=function(e){return{pad:function(r){var t=r[r.length-1>=0?r.length-1:0],n=t.length;if(n===e){var o,a=[];for(o=0;o<e;o+=1)a.push(e);r.push(a)}else for(var i=e-n&255;t.length!==e;)t.push(i)},unpad:function(r){var t=!0;r.length%e!=0&&(t=!1);for(var n=r.slice(-e),o=n[n.length-1],a=0;a<e;a++){var i=e-a<=o,s=n[a]===o;t=(!i||s)&&t}var u=t?o:0;return r.length-=u,t}}};var q=function(e){var r=e.blockSize/8,t=G.pkcsv7(r),n=function(e){var r,t,n=[];for(r=0;r<e.length;r+=1){var o=e[r];for(t=0;t<o.length;t+=1)n.push(o[t])}return n};function o(e){var t=[];u=u.concat(e);for(var n=Math.floor(u.length/r),o=0;o<n;o++)t.push(u.slice(o*r,(o+1)*r));return u=u.slice(n*r),t}function a(r){for(var t,n=[],o=0;o<r.length;o++)t=y.xorVectors(s,r[o]),n.push(e.encrypt(t)),s=n[o];return n}function i(){u=[],l=[],s=null}var s,u=[],l=[];return{init:function(e){if(e.length!==r)throw new Error("Invalid iv size");s=e.slice()},encrypt:function(e){var r=a(o(e));return l=l.concat(n(r)),this.finishEncrypt()},processEncrypt:function(e){return n(a(o(e)))},finishEncrypt:function(){var e=1===u.length?[[u[0]]]:[u];t.pad(e);var r=l.concat(n(a(e)));return i(),r},decrypt:function(e){return this.processDecrypt(e),this.finishDecrypt()},processDecrypt:function(r){var t=function(r){for(var t,n,o=[],a=0;a<r.length;a+=1)t=r[a].slice(0,r[a].length),n=e.decrypt(t),o.push(y.xorVectors(s,n)),s=r[a];return o}(o(r));l=l.concat(n(t))},finishDecrypt:function(){var e=l;return t.unpad(e),i(),e}}};if(void 0!==r){var L={};q.workerEncrypt=function(e){var r,t=e.workerid;return L[t]||(L[t]=q(z.aes(e.keyData)),L[t].init(e.algorithm.iv)),"process"===e.operationSubType?L[t].processEncrypt(e.buffer):"finish"===e.operationSubType?(r=L[t].finishEncrypt(),L[t]=null,r):(r=L[t].encrypt(e.buffer),L[t]=null,r)},q.workerDecrypt=function(e){var r,t=e.workerid;if(L[t]||(L[t]=q(z.aes(e.keyData)),L[t].init(e.algorithm.iv)),"process"!==e.operationSubType)return"finish"===e.operationSubType?(r=L[t].finishDecrypt(),L[t]=null,r):(r=L[t].decrypt(e.buffer),L[t]=null,r);L[t].processDecrypt(e.buffer)},q.generateKey=function(e){if(e.algorithm.length%8!=0)throw new Error;return{type:"keyGeneration",keyData:Z.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},q.importKey=function(e){var r,t=8*e.keyData.length;if("jwk"===e.format)r=p.jwkToKey(e.keyData,e.algorithm,["k"]);else{if("raw"!==e.format)throw new Error("unsupported import format");if(128!==t&&192!==t&&256!==t)throw new Error("invalid key length (should be 128, 192, or 256 bits)");r={k:y.toArray(e.keyData)}}return e.algorithm.length=8*r.k.length,{keyData:r.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"},type:"keyImport"}},q.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new Error("unsupported export format")},r.register("importKey","AES-CBC",q.importKey),r.register("exportKey","AES-CBC",q.exportKey),r.register("generateKey","AES-CBC",q.generateKey),r.register("encrypt","AES-CBC",q.workerEncrypt),r.register("decrypt","AES-CBC",q.workerDecrypt)}var W=function(e){var r,t,n,o,a,i,s=y,u=[],l=e.encrypt(s.getVector(16)),c=s.getVector(16),f=[],h=[],g=0;function p(e,r){for(var t,n=Math.floor(r.length/16),o=0;o<n;o++)t=r.slice(16*o,16*o+16),c=v(s.xorVectors(c,t),e);return f=r.slice(16*n),c}function d(){var e=16*Math.ceil(g/16)-g,r=E(8*t.length),n=E(8*g),o=f.concat(s.getVector(e)).concat(r).concat(n);return p(l,o)}function v(e,r){var t,n,o,a,i,u,l=s.getVector(16),c=r.slice(0);for(o=0;o<128;o++){for(t=255&(a=e,i=o,u=void 0,u=Math.floor(i/8),-(a[u]>>7-i%8&1)),n=0;n<16;n++)l[n]=l[n]^c[n]&t;t=255&-(1&c[15]),m(c),c[0]^=225&t}return l}function m(e){for(var r=e.length-1;r>0;r--)e[r]=(1&e[r-1])<<7|e[r]>>>1;return e[0]=e[0]>>>1,e}function w(e){for(var r=256,t=1;t<=4;t++)r=(r>>>8)+e[e.length-t],e[e.length-t]=255&r;return e}function k(r,t){var n,o=Math.ceil(t.length/16),a=[];i!==r&&(i=r.slice());for(var u=0;u<o;u++){n=t.slice(16*u,16*u+16);var l=e.encrypt(i.slice());a=a.concat(s.xorVectors(n,l)),i=w(i)}return a}function E(e){return[0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]}function b(){g=0,u=[],h=[],c=s.getVector(16),f=[],i=r=t=null}return{init:function(e,i,u){if(t=i||[],(n=isNaN(u)?128:u)%8!=0)throw new Error("DataError");if(12===(r=e).length)o=r.concat([0,0,0,1]);else{var f=16*Math.ceil(r.length/16)-r.length;o=p(l,r.concat(s.getVector(f+8)).concat(E(8*r.length))),c=s.getVector(16)}var y,h;a=w(o.slice()),p(l,(y=t,h=16*Math.ceil(t.length/16)-t.length,y.concat(s.getVector(h))))},encrypt:function(e){g=e.length;var r=k(a,e);p(l,r);var t=d(),i=k(o,t).slice(0,n/8);return b(),r.slice().concat(i)},decrypt:function(e,r){g=e.length;var t=k(a,e);p(l,e);var i=d(),u=k(o,i).slice(0,n/8);return b(),s.arraysEqual(u,r)?t:null},processEncrypt:function(e){var r=(u=u.concat(e)).slice(0,16*Math.floor(u.length/16));g+=r.length,u=u.slice(r.length);var t=k(i||a,r);h=h.concat(t),p(l,t)},processDecrypt:function(e){var r=(u=u.concat(e)).slice(0,16*Math.floor((u.length-n/8)/16));g+=r.length,u=u.slice(r.length);var t=k(i||a,r);h=h.concat(t),p(l,r)},finishEncrypt:function(){var e=k(i,u);h=h.concat(e),g+=u.length;var r=d(),t=k(o,r).slice(0,n/8),a=h.slice().concat(t);return b(),a},finishDecrypt:function(){var e=Math.floor(n/8),r=u.slice(-e);u=u.slice(0,u.length-e);var t=k(i,u);h=h.concat(t),g+=u.length;var a=d(),l=k(o,a).slice(0,n/8),c=h.slice();return b(),s.arraysEqual(l,r)?c:null}}};if(void 0!==r){var j={};W.encrypt=function(e){var r,t=e.workerid;if(j[t]||(j[t]=W(z.aes(e.keyData)),j[t].init(e.algorithm.iv,e.algorithm.additionalData,e.algorithm.tagLength)),"process"!==e.operationSubType)return"finish"===e.operationSubType?(r=j[t].finishEncrypt(),j[t]=null,r):(r=j[t].encrypt(e.buffer),j[t]=null,r);j[t].processEncrypt(e.buffer)},W.decrypt=function(e){var r,t=e.workerid;if(j[t]||(j[t]=W(z.aes(e.keyData)),j[t].init(e.algorithm.iv,e.algorithm.additionalData,e.algorithm.tagLength)),"process"!==e.operationSubType){if("finish"===e.operationSubType){if(r=j[t].finishDecrypt(),j[t]=null,null===r)throw new Error("OperationError");return r}var n=e.algorithm.tagLength?Math.floor(e.algorithm.tagLength/8):16,o=e.buffer.slice(0,e.buffer.length-n),a=e.buffer.slice(-n);if(r=j[t].decrypt(o,a),j[t]=null,null===r)throw new Error("OperationError");return r}j[t].processDecrypt(e.buffer)},W.generateKey=function(e){if(e.algorithm.length%8!=0)throw new Error;return{type:"keyGeneration",keyData:Z.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},W.importKey=function(e){var r,t=8*e.keyData.length;if("jwk"===e.format)r=p.jwkToKey(e.keyData,e.algorithm,["k"]);else{if("raw"!==e.format)throw new Error("unsupported import format");if(128!==t&&192!==t&&256!==t)throw new Error("invalid key length (should be 128, 192, or 256 bits)");r={k:y.toArray(e.keyData)}}return{type:"keyImport",keyData:r.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"}}},W.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new Error("unsupported export format")},r.register("importKey","AES-GCM",W.importKey),r.register("exportKey","AES-GCM",W.exportKey),r.register("generateKey","AES-GCM",W.generateKey),r.register("encrypt","AES-GCM",W.encrypt),r.register("decrypt","AES-GCM",W.decrypt)}var Q=function(e){return{encrypt:function(r){for(var t=[[0]],n=0;n<r.length;n+=8)t.push(r.slice(n,n+8));var o=[166,166,166,166,166,166,166,166],a=t.length-1,i=[];for(n=1;n<=a;n++)i[n]=t[n];for(var s=0;s<=5;s++)for(n=1;n<=a;n++){var u=a*s+n,l=e.encrypt(o.concat(i[n]));i[n]=l.slice(8),o=l.slice(0,8);for(var c=7;u>0;c--,u>>>=8)o[c]^=255&u}var f=o;for(n=1;n<=a;n++)f=f.concat(i[n]);return f},decrypt:function(r){for(var t=[],n=0;n<r.length;n+=8)t.push(r.slice(n,n+8));var o=t.length-1,a=[],i=[],s=t[0];for(n=1;n<=o;n++)a[n]=t[n];for(var u=5;u>=0;u--)for(n=o;n>=1;n--){for(var l=o*u+n,c=7;l>0;c--,l>>>=8)s[c]^=255&l;var f=e.decrypt(s.concat(a[n]));s=f.slice(0,8),a[n]=f.slice(8)}if("166,166,166,166,166,166,166,166"!==s.join(","))throw y.error("OperationError","");for(n=1;n<=o;n++)i=i.concat(a[n]);return i}}};if(void 0!==r){var V={};Q.workerEncrypt=function(e){var r,t=e.workerid;if(e.buffer.length%8!=0)throw y.error("DataError","The AES-KW input data length is invalid: not a multiple of 8 bytes");return V[t]||(V[t]=Q(z.aes(e.keyData))),r=V[t].encrypt(e.buffer),V[t]=null,r},Q.workerDecrypt=function(e){var r,t=e.workerid;if(e.buffer.length%8!=0)throw y.error("DataError","The AES-KW input data length is invalid: not a multiple of 8 bytes");return V[t]||(V[t]=Q(z.aes(e.keyData))),r=V[t].decrypt(e.buffer),V[t]=null,r},Q.generateKey=function(e){if(e.algorithm.length%8!=0)throw y.error("OperationError","AES key length must be 128, 192, or 256 bits");return{type:"keyGeneration",keyData:Z.getBytes(Math.floor(e.algorithm.length/8)),keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"secret"}}},Q.importKey=function(e){var r,t=8*e.keyData.length;if("jwk"===e.format)r=p.jwkToKey(e.keyData,e.algorithm,["k"]);else{if("raw"!==e.format)throw new TypeError("Invalid keyFormat argument");if(128!==t&&192!==t&&256!==t)throw y.error("OperationError","AES key length must be 128, 192, or 256 bits");r={k:y.toArray(e.keyData)}}return e.algorithm.length=8*r.k.length,{keyData:r.k,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||r.extractable,usages:e.usages,type:"secret"},type:"keyImport"}},Q.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("raw"===e.format)return{type:"keyExport",keyHandle:e.keyData};throw new TypeError("Invalid keyFormat argument")},r.register("importKey","AES-KW",Q.importKey),r.register("exportKey","AES-KW",Q.exportKey),r.register("generateKey","AES-KW",Q.generateKey),r.register("encrypt","AES-KW",Q.workerEncrypt),r.register("decrypt","AES-KW",Q.workerDecrypt)}function J(){if(!(this instanceof J))throw new Error("create MsrcryptoPrng object with new keyword");var e,r,t,n,o=!1,a=1,i=Math.pow(2,48);function s(e){var r;for(r=e.length-1;r>=0&&(e[r]+=1,e[r]>=256&&(e[r]=0),!e[r]);r-=1);}function u(){e=y.getVector(32),r=y.getVector(16),t=32,n=48,a=1}function l(e,r){if((r=r||[0]).length>n)throw new Error("Incorrect entropy or additionalEntropy length");r=r.concat(y.getVector(n-r.length)),e=e.concat(y.getVector((n-e.length%n)%n));for(var t=0;t<e.length;t+=n)c(y.xorVectors(e.slice(t,t+n),r));a=1}function c(o){for(var a=[],i=new z.aes(e);a.length<n;){s(r);var u=r.slice(0,16),l=i.encrypt(u);a=a.concat(l)}a=y.xorVectors(a,o),e=a.slice(0,t),r=a.slice(t)}function f(t,o){if(t>=65536)throw new Error("too much random requested");if(a>i)throw new Error("Reseeding is required");if(o&&o.length>0){for(;o.length<n;)o=o.concat(y.getVector(n-o.length));c(o)}else o=y.getVector(n);for(var u=[],l=new z.aes(e);u.length<t;){s(r);var f=r.slice(0,r.length),h=l.encrypt(f);u=u.concat(h)}return u=u.slice(0,t),c(o),a+=1,u}return u(),{reseed:l,getBytes:function(e,r){if(!o)throw new Error("can't get randomness before initialization");return f(e,r)},getNonZeroBytes:function(e,r){if(!o)throw new Error("can't get randomness before initialization");for(var t,n=[];n.length<e;){t=f(e,r);for(var a=0;a<t.length;a+=1)0!==t[a]&&n.push(t[a])}return n.slice(0,e)},init:function(e,r){if(e.length<n)throw new Error("Initial entropy length too short");u(),l(e,r),o=!0}}}var Z=new J;var Y,_=function(){var e=[],r=[],t=16384;function n(t){var n,o=r.length;for(n=0;n<o;n++)if((r[n]+t)%e[n]==0)return!1;return!0}function o(n){var o,a,i,s,u,l,c=n.length-1,f=d.DIGIT_BASE,y=n[c];for(0===e.length&&(e=function(e){var r,t,n=new Array(e+1),o=[],a=0|Math.sqrt(e);for(r=3;r<=a;r+=2)for(t=r*r;t<=e;t+=2*r)n[t]=0;for(r=3;r<=e;r+=2)0!==n[r]&&o.push(r);return o}(t)),l=e.length,r=new Array(l),o=0;o<l;o++){for(a=c,y<(u=e[o])?(i=y,a--):i=0;a>=0;)i=(s=i*f+n[a--])-(s/u|0)*u;r[o]=i}}function a(e,r){var t=e,n=[];d.subtract(t,[1],n);var o=function(e){var r,t=0,n=0;if(d.isZero(e))return 0;for(t=0;0===e[t];t++);for(n=0,r=2;e[t]%r==0;r*=2,n++);return t*d.DIGIT_BITS+n}(n),a=[];d.shiftRight(n,a,o);for(var s,u=function(e){var r=0,t=0,n=0;if(d.isZero(e))return 0;for(r=e.length-1;0===e[r];r--);for(n=1<<(t=d.DIGIT_BITS-1);t>0&&0==(e[r]&n);n>>>=1,t--);return r*d.DIGIT_BITS+t}(t),l=d.MontgomeryMultiplier(t),c=1;c<=r;c++){var f=!1;do{s=i(u)}while(d.compareDigits(s,n)>=0);var y=[];if(l.modExp(s,a,y,!0),0!==d.compareDigits(y,[1])&&0!==d.compareDigits(y,n)){for(var h=1;h<o;h++){if(l.montgomeryMultiply(y,y,y),0===d.compareDigits(y,n)){f=!0;break}if(0===d.compareDigits(y,[1]))return!1}if(!1===f)return!1}}return!0}function i(e){var r=Math.ceil(e/8),t=Z.getBytes(r);return t[0]|=128,t[t.length-1]|=1,d.bytesToDigits(t)}return{generatePrime:function(e){var r=i(e),t=0,s=[];for(o(r);;){if(n(t)&&(d.add(r,[t],s),!0===a(s,6)))return s;t+=2}}}}(),X=function(e){var r=y,t=e.hasOwnProperty("n")&&e.hasOwnProperty("d"),n=e.hasOwnProperty("p")&&e.hasOwnProperty("q"),o=e.n.length;function a(e){var t=d.digitsToBytes(e);return r.padFront(t,0,o),t}function i(e,r,t){var n=d.bytesToDigits(r),o=d.IntegerGroup(t),a=o.createElementFromBytes(e);return o.modexp(a,n).m_digits}return{encrypt:function(r){return a(i(r,e.e,e.n))},decrypt:function(r){if(n)return function(r){var t=d.bytesToDigits,n=e.p,o=e.q,i=e.dp,s=e.dq,u=e.qi,l=t(n),c=t(o),f=new Array(l.length+c.length),y=new Array(l.length+1),h=new Array(c.length+1),g=t(r),p=d.MontgomeryMultiplier,v=new p(e.ctxp?void 0:l,e.ctxp),m=new p(e.ctxq?void 0:c,e.ctxq);v.reduce(g,f),v.modExp(f,t(i),y),m.reduce(g,f),m.modExp(f,t(s),h);var w=d.subtract(y,h,f);return 0!==w&&d.subtract(h,y,f),d.modMul(f,t(u),l,g),0!==w&&d.subtract(l,g,g),d.multiply(g,c,f),d.add(h,f,y),a(y)}(r);if(t)return function(r){return a(i(r,e.d,e.n))}(r);throw new Error("missing private key")}}},$={mgf1:function(e,r,t){var n,o,a,i=[],s=t.hashLen/8;for(a=0;a<=Math.floor(r/s);a+=1)n=[a>>>24&255,a>>>16&255,a>>>8&255,255&a],o=t.computeHash(e.concat(n)),i=i.concat(o);return i.slice(0,r)},checkMessageVsMaxHash:function(e,r){if(e.length>(r.maxMessageSize||4294967295))throw new Error("message too long")}};(Y=Y||{}).oaep=function(e,r){var t=y,n=Z,o=e.n.length;if(null===r)throw new Error("must supply hashFunction");return{pad:function(e,a){return function(e,a){var i,s,u,l,c,f,y,h,g;if(e.length>o-r.hashLen/8*2-2)throw new Error("Message too long.");return null==a&&(a=[]),i=r.computeHash(a),s=o-e.length-2*i.length-2,u=t.getVector(s),l=i.concat(u,[1],e),c=n.getBytes(i.length),f=$.mgf1(c,o-i.length-1,r),y=t.xorVectors(l,f),h=$.mgf1(y,i.length,r),g=t.xorVectors(c,h),e=[0].concat(g).concat(y).slice()}(e,a)},unpad:function(e,n){return function(e,n){var a,i,s,u,l,c,f,y,h=0,g=0===e[0];for(n||(n=[]),a=r.computeHash(n),i=e.slice(1,a.length+1),s=e.slice(a.length+1),u=$.mgf1(s,a.length,r),l=t.xorVectors(i,u),c=$.mgf1(l,o-a.length-1,r),y=(f=t.xorVectors(s,c)).slice(0,a.length),g=g&&t.arraysEqual(a,y),f=f.slice(a.length);!f[h++];);return{valid:g,data:f.slice(h)}}(e,n)}}},(Y=Y||{}).pkcs1Encrypt=function(e){var r=Z,t=e.n.length;return{pad:function(e){return function(e){var n;if(e.length>t-11)throw new Error("message too long");return n=r.getNonZeroBytes(t-e.length-3),[0,2].concat(n,[0],e)}(e)},unpad:function(e){return function(e){var r,t=function(e){for(var r=0===e[0]&&2===e[1],t=2;t<10;t++)r=r&&!!e[t];return r}(e),n=0;for(r=1;r<e.length;r+=1)n=n||+!e[r]&&r+1;return n=-t&&n,{data:e.slice(n),valid:t}}(e)}}},Y.pkcs1Sign=function(e,r){var t=y,n=e.n.length;function o(e){var o,a,i;if(a=r.computeHash(e.slice()),i=(o=r.der.concat(a)).length,n<i+11)throw new Error("intended encoded message length too short");return[0,1].concat(t.getVector(n-i-3,255),[0],o)}return{sign:function(e){return o(e)},verify:function(e,r){var n=o(r);return t.arraysEqual(e,n)}}},(Y=Y||{}).pss=function(e,r){var t=y,n=Z;return{sign:function(o,a,i){return function(o,a,i){var s=d.bitLength(e.n)-1,u=Math.ceil(s/8),l=r.computeHash(o);if(a=i?i.length:null==a?l.length:a,u<l.length+a+2)throw new Error("encoding error");i=i||n.getBytes(a);for(var c=[0,0,0,0,0,0,0,0].concat(l,i),f=r.computeHash(c),y=t.getVector(u-i.length-f.length-2).concat([1],i),h=$.mgf1(f,u-f.length-1,r),g=t.xorVectors(y,h),p=0,v=0;v<8-(8*u-s);v++)p+=1<<v;return g[0]&=p,g.concat(f,[188])}(o,a,i)},verify:function(n,o,a){return function(n,o,a){var i=d.bitLength(e.n)-1,s=Math.ceil(i/8),u=r.computeHash(o),l=u.length;if(s<l+(a=null==a?l:a)+2)return!1;var c=n.slice(0,s-l-1),f=n.slice(c.length,c.length+l),y=$.mgf1(f,s-l-1,r),h=t.xorVectors(c,y);h[0]&=255>>>8-(8*s-i);for(var g=0;g<s-l-a-2;g++)if(0!==h[g])return!1;if(1!==h[s-l-a-2])return!1;var p=h.slice(h.length-a),v=[0,0,0,0,0,0,0,0].concat(u,p),m=r.computeHash(v);return t.arraysEqual(m,f)}(n,o,a)}}};var ee=function(e,r,t){var n=X(e);if(!r)throw new Error("padding mode");function o(){if(!t||!t.computeHash)throw new Error("missing hash function")}var a,i=null,s=null;switch(r){case"RSAES-PKCS1-V1_5":a=Y.pkcs1Encrypt(e);break;case"RSASSA-PKCS1-V1_5":o(),a=Y.pkcs1Sign(e,t);break;case"RSA-OAEP":o(),a=Y.oaep(e,t);break;case"RSA-PSS":o(),a=Y.pss(e,t);break;case"raw":a={pad:function(e){return e},unpad:function(e){return e}};break;default:throw new Error("invalid mode")}return a&&(i=a.pad||a.sign,s=a.unpad||a.verify),{encrypt:function(e,r){var t;return t=null!==i?i(e,r):e.slice(),n.encrypt(t)},decrypt:function(e,r){var t=n.decrypt(e);if(null!==s){if(!1===(t=s(t,r)).valid)throw new Error("OperationError");t=t.data}else t=t.slice(0);return t},signData:function(e,r,t){return n.decrypt(i(e,r,t))},verifySignature:function(e,r,t){var o=n.encrypt(e);return s(o,r,t)},generateKeyPair:function(e){genRsaKeyFromRandom(e)},mode:r}};void 0!==r&&(ee.sign=function(e){var r=e.keyHandle.algorithm.hash.name,t=f[r.toUpperCase()](),n=e.algorithm.saltLength,o=e.algorithm.salt;return ee(e.keyData,e.algorithm.name,t).signData(e.buffer,n,o)},ee.verify=function(e){var r=e.keyHandle.algorithm.hash.name,t=f[r.toUpperCase()](),n=e.algorithm.saltLength;return ee(e.keyData,e.algorithm.name,t).verifySignature(e.signature,e.buffer,n)},ee.workerEncrypt=function(e){var r,t,n;switch(e.algorithm.name){case"RSAES-PKCS1-V1_5":r=ee(e.keyData,e.algorithm.name).encrypt(e.buffer);break;case"RSA-OAEP":if(!(n=e.keyHandle.algorithm.hash.name))throw new Error("unsupported hash algorithm");t=f[n.toUpperCase()](),r=ee(e.keyData,e.algorithm.name,t).encrypt(e.buffer);break;default:throw new Error("unsupported algorithm")}return r},ee.workerDecrypt=function(e){var r,t;switch(e.algorithm.name){case"RSAES-PKCS1-V1_5":r=ee(e.keyData,e.algorithm.name).decrypt(e.buffer);break;case"RSA-OAEP":var n=e.keyHandle.algorithm.hash.name;if(!n)throw new Error("unsupported hash algorithm");t=f[n.toUpperCase()](),r=ee(e.keyData,e.algorithm.name,t).decrypt(e.buffer);break;default:throw new Error("unsupported algorithm")}return r},ee.importKey=function(e){var r;if("jwk"===e.format)(r=p.jwkToKey(e.keyData,e.algorithm,["n","e","d","p","q","dp","dq","qi"])).d&&(r.ctxp=new d.MontgomeryMultiplier(d.bytesToDigits(r.p)).ctx,r.ctxq=new d.MontgomeryMultiplier(d.bytesToDigits(r.q)).ctx);else if("spki"===e.format){if(null==(a=h.parse(e.keyData)))throw new Error("invalid key data.");var t=a[1];if(null==(i=h.parse(t.data.slice(t.header+1),!0)))throw new Error("invalid key data.");var n=i[0],o=i[1];if("INTEGER"!==n.type||"INTEGER"!==o.type)throw new Error("invalid key data.");n=n.data.slice(n.header),o=o.data.slice(o.header),0===n[0]&&128&n[1]&&(n=n.slice(1)),0===o[0]&&128&o[1]&&(o=o.slice(1)),r={n:n,e:o}}else{if("pkcs8"!==e.format)throw new Error("unsupported key import format.");var a,i;if(null==(a=h.parse(e.keyData)))throw new Error("invalid key data.");if(t=a[2],null==(i=h.parse(t.data.slice(t.header),!0)))throw new Error("invalid key data.");var s=["n","e","d","p","q","dp","dq","qi"];r={};for(var u=1;u<i.length;u++){var l=i[u];0===(l=l.data.slice(l.header))[0]&&128&l[1]&&(l=l.slice(1)),r[s[u-1]]=l}}return{type:"keyImport",keyData:r,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:r.d||r.dq?"private":"public"}}},ee.exportKey=function(e){if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("spki"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.113549.1.1.1"},{NULL:1}]},{"BIT STRING":{SEQUENCE:[{INTEGER:e.keyData.n},{INTEGER:e.keyData.e}]}}]})};if("pkcs8"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{INTEGER:0},{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.113549.1.1.1"},{NULL:1}]},{"OCTET STRING":{SEQUENCE:[{INTEGER:0},{INTEGER:e.keyData.n},{INTEGER:e.keyData.e},{INTEGER:e.keyData.d},{INTEGER:e.keyData.p},{INTEGER:e.keyData.q},{INTEGER:e.keyData.dp},{INTEGER:e.keyData.dq},{INTEGER:e.keyData.qi}]}}]})};throw new Error(e.format+" not implemented")},ee.genRsaKeyFromRandom=function(e,r){var t=r?d.bytesToDigits(r):[65537];do{var n=_.generatePrime(e/2),o=_.generatePrime(e/2);if(d.compareDigits(o,n)>0){var a=n;n=o,o=a}var i=[];d.multiply(n,o,i);var s=[];d.subtract(n,[1],s);var u=[];d.subtract(o,[1],u);var l=[];d.multiply(s,u,l);var c=[];d.gcd(t,l,c);var f=0===d.compareDigits(c,d.One)}while(!f);var y=[];d.modInv(t,l,y);var h=[];d.reduce(y,s,h);var g=[];d.reduce(y,u,g);var p=[];d.modInv(o,n,p);var v=d.digitsToBytes;return{privateKey:{n:v(i),e:v(t),d:v(y),p:v(n),q:v(o),dp:v(h),dq:v(g),qi:v(p)},publicKey:{n:v(i),e:v(t)}}},ee.generateKeyPair=function(e){if(void 0===e.algorithm.modulusLength)throw new Error("missing modulusLength");var r,t=d.bytesToDigits;switch(e.algorithm.modulusLength){case 1024:case 2048:case 4096:r=ee.genRsaKeyFromRandom(e.algorithm.modulusLength,e.algorithm.publicExponent);break;default:throw new Error("invalid modulusLength")}var n=r.privateKey;n.ctxp=new d.MontgomeryMultiplier(t(n.p)).ctx,n.ctxq=new d.MontgomeryMultiplier(t(n.q)).ctx;var o,a,i=e.algorithm.name;return i.slice(i.indexOf("-")+1).toUpperCase(),"RSASSA-PKCS1-V1_5"===i||"RSA-PSS"===i?(o=["verify"],a=["sign"]):(o=["encrypt"],a=["decrypt"]),{type:"keyGeneration",keyPair:{publicKey:{keyData:r.publicKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:o,type:"public"}},privateKey:{keyData:r.privateKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:a,type:"private"}}}}},r.register("sign","RSASSA-PKCS1-V1_5",ee.sign),r.register("sign","RSA-PSS",ee.sign),r.register("verify","RSASSA-PKCS1-V1_5",ee.verify),r.register("verify","RSA-PSS",ee.verify),r.register("encrypt","RSAES-PKCS1-V1_5",ee.workerEncrypt),r.register("decrypt","RSAES-PKCS1-V1_5",ee.workerDecrypt),r.register("encrypt","RSA-OAEP",ee.workerEncrypt),r.register("decrypt","RSA-OAEP",ee.workerDecrypt),r.register("importKey","RSA-OAEP",ee.importKey),r.register("importKey","RSAES-PKCS1-V1_5",ee.importKey),r.register("importKey","RSASSA-PKCS1-V1_5",ee.importKey),r.register("importKey","RSA-PSS",ee.importKey),r.register("exportKey","RSA-OAEP",ee.exportKey),r.register("exportKey","RSAES-PKCS1-V1_5",ee.exportKey),r.register("exportKey","RSASSA-PKCS1-V1_5",ee.exportKey),r.register("exportKey","RSA-PSS",ee.exportKey),r.register("generateKey","RSA-OAEP",ee.generateKeyPair),r.register("generateKey","RSAES-PKCS1-V1_5",ee.generateKeyPair),r.register("generateKey","RSASSA-PKCS1-V1_5",ee.generateKeyPair),r.register("generateKey","RSA-PSS",ee.generateKeyPair));var re={deriveBits:function(e){for(var r=e.algorithm.hash.name,t=f[r.toUpperCase()](),n=e.algorithm,o=ue.toArray(n.algorithmId).concat(ue.toArray(n.partyUInfo),ue.toArray(n.partyVInfo),ue.toArray(n.publicInfo)||[],ue.toArray(n.privateInfo)||[]),a=Math.ceil(e.length/t.hashLen),i=1,s=e.keyData.concat(o),u=[],l=0;l<a;l++){var c=ue.int32ToBytes(i++).concat(s),y=t.computeHash(c);u=u.concat(y)}return u.slice(0,e.length/8)}};void 0!==r&&(re.importKey=function(e){var r;if("raw"!==e.format)throw new Error("unsupported import format");if(r=y.toArray(e.keyData),!1!==e.extractable)throw new Error("only extractable=false is supported.");return{type:"keyImport",keyData:r,keyHandle:{algorithm:{name:"CONCAT"},extractable:!1,usages:e.usages,type:"secret"}}},r.register("deriveBits","CONCAT",re.deriveBits),r.register("importKey","CONCAT",re.importKey));var te={deriveBits:function(e){var r,t,n=e.algorithm,o=e.keyData,a=e.length,i=n.iterations,s=Array.apply(null,n.salt),u=Math.ceil(a/8),l=[];switch(n.hash.name.toUpperCase()){case"SHA-1":r=20;break;case"SHA-256":r=32;break;case"SHA-384":r=48;break;case"SHA-512":r=64;break;default:throw new Error("Unsupported hash algorithm")}t=Math.ceil(u/r);var c=I.importKey({format:"raw",keyData:o,algorithm:{name:"HMAC",hash:n.hash}}),f={algorithm:n,keyHandle:c.keyHandle,keyData:c.keyData,workerid:0,buffer:null};function y(e,t,n){for(var o=[],a=e.concat([n>>>24&255,n>>>16&255,n>>>8&255,255&n]),i=0;i<t;i++){f.buffer=a,a=I.signHmac(f);for(var s=0;s<r;s++)o[s]=~~o[s]^a[s]}return o}for(var h=1;h<=t;h++)l=l.concat(y(s,i,h));return l.length=u,l}};void 0!==r&&(te.importKey=function(e){var r;if("raw"!==e.format)throw new Error("unsupported import format");if(r=y.toArray(e.keyData),!1!==e.extractable)throw new Error("only extractable=false is supported.");return{type:"keyImport",keyData:r,keyHandle:{algorithm:{name:"PBKDF2"},extractable:!1,usages:e.usages,type:"secret"}}},r.register("deriveBits","PBKDF2",te.deriveBits),r.register("importKey","PBKDF2",te.importKey));var ne={deriveBits:function(e){var r,t,n,o=e.algorithm,a=e.keyData,i=e.length,s=o.salt,u=Math.ceil(i/8),l=[],c=y.toArray(o.info),f=[];switch(o.hash.name.toUpperCase()){case"SHA-1":r=20;break;case"SHA-256":r=32;break;case"SHA-384":r=48;break;case"SHA-512":r=64;break;default:throw new Error("Unsupported hash algorithm.")}if(null==o.salt)throw new Error("HkdfParams: salt: Missing required property.");if(null==o.info)throw new Error("HkdfParams: info: Missing required property.");if(i%8!=0)throw new Error("The length provided for HKDF is not a multiple of 8 bits.");if(u>255*r)throw new Error("The length provided for HKDF is too large.");for(0===s.length&&(s=y.getVector(r)),(n={workerid:0,keyHandle:{algorithm:o},keyData:s,buffer:a}).keyData=I.signHmac(n),t=0;t<Math.ceil(u/r);t++)n.buffer=f.concat(c).concat([1+t]),f=I.signHmac(n),l=l.concat(f);return l.slice(0,u)}};void 0!==r&&(ne.importKey=function(e){var r;if("raw"!==e.format)throw new Error("unsupported import format");if(r=y.toArray(e.keyData),!1!==e.extractable)throw new Error("only extractable=false is supported.");return{type:"keyImport",keyData:r,keyHandle:{algorithm:{name:"HKDF"},extractable:!1,usages:e.usages,type:"secret"}}},r.register("deriveBits","HKDF",ne.deriveBits),r.register("importKey","HKDF",ne.importKey));var oe={deriveBits:function(e){var r,t,n,o=e.algorithm,a=e.keyData,i=e.length,s=o.label,u=o.context,l=Math.ceil(i/8),c=[];switch(o.hash.name.toUpperCase()){case"SHA-1":r=20;break;case"SHA-256":r=32;break;case"SHA-384":r=48;break;case"SHA-512":r=64;break;default:throw new Error("Unsupported hash algorithm.")}if(null==o.label)throw new Error("HkdfCtrParams: label: Missing required property.");if(null==o.context)throw new Error("HkdfCtrParams: context: Missing required property.");if(i%8!=0)throw new Error("The length provided for HKDF-CTR is not a multiple of 8 bits.");if(l>255*r)throw new Error("The length provided for HKDF-CTR is too large.");n={workerid:0,keyHandle:{algorithm:o},keyData:a,buffer:a};var f=s.concat([0],u,ue.int32ToBytes(i));for(t=1;t<=Math.ceil(l/r);t++)n.buffer=ue.int32ToBytes(t).concat(f),c=c.concat(I.signHmac(n));return c.slice(0,l)}};void 0!==r&&(oe.importKey=function(e){var r;if("raw"!==e.format)throw new Error("unsupported import format");if(r=y.toArray(e.keyData),!1!==e.extractable)throw new Error("only extractable=false is supported.");return{type:"keyImport",keyData:r,keyHandle:{algorithm:{name:"HKDF-CTR"},extractable:!1,usages:e.usages,type:"secret"}}},r.register("deriveBits","HKDF-CTR",oe.deriveBits),r.register("importKey","HKDF-CTR",oe.importKey));var ae=function(e){var r=d.bytesToDigits,t=d.digitsToBytes,n=e,o=new v.EllipticCurveOperatorFp(e);return{generateKey:function(r){var a=[],i=Z.getBytes(e.order.length*d.DIGIT_NUM_BYTES);d.reduce(d.bytesToDigits(i),n.order,a);var s=n.allocatePointStorage();return o.scalarMultiply(a,n.generator,s),{privateKey:{x:t(s.x),y:t(s.y),d:t(a)},publicKey:{x:t(s.x),y:t(s.y)}}},deriveBits:function(e,t,a){var i=new v.EllipticCurvePointFp(n,!1,r(t.x),r(t.y),null,!1),s=n.allocatePointStorage();o.convertToJacobianForm(s),o.convertToMontgomeryForm(s),o.scalarMultiply(r(e.d),i,s),o.convertToAffineForm(s),o.convertToStandardForm(s);var u=d.digitsToBytes(s.x,!0,t.x.length);if(a&&8*u.length<a)throw new Error("DataError");var l=a%8,c=0===l?255:65280>>>l;return(u=a?u.slice(0,Math.ceil(a/8)):u)[u.length-1]=u[u.length-1]&c,u},computePublicKey:function(e){n.generator.isInMontgomeryForm||o.convertToMontgomeryForm(n.generator);var a=n.allocatePointStorage();return o.convertToJacobianForm(a),o.convertToMontgomeryForm(a),o.scalarMultiply(r(e),n.generator,a),{x:t(a.x),y:t(a.y)}}}};void 0!==r&&(ae.deriveBits=function(e){var r=v.createCurve(e.algorithm.namedCurve.toUpperCase()),t=e.keyData,n=e.additionalKeyData;return ae(r).deriveBits(t,n,e.length)},ae.deriveKey=function(e){throw new Error("not supported")},ae.generateKey=function(e){var r=v.createCurve(e.algorithm.namedCurve.toUpperCase()),t=ae(r).generateKey();return{type:"keyPairGeneration",keyPair:{publicKey:{keyData:t.publicKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:[],type:"public"}},privateKey:{keyData:t.privateKey,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"private"}}}}},ae.importKey=function(e){try{if("raw"===e.format){var r=e.keyData;if(4!==r[0])throw new Error("DataError");var t=~~((r.length-1)/2),n=e.algorithm.namedCurve.toUpperCase(),o=r.slice(1,t+1),a=r.slice(t+1);if(!1===v.validatePoint(n,o,a))throw new Error("DataError");return{type:"keyImport",keyData:{x:o,y:a},keyHandle:{algorithm:e.algorithm,extractable:e.extractable||!1,usages:e.usages,type:"public"}}}if("jwk"===e.format){if((l=p.jwkToKey(e.keyData,e.algorithm,["x","y","d","crv"])).d&&(!l.x||!l.y)){var i=v.createCurve(e.algorithm.namedCurve.toUpperCase()),s=ae(i).computePublicKey(l.d);l.x=s.x,l.y=s.y}if(!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||l.extractable,usages:e.usages,type:l.d?"private":"public"}}}if("spki"===e.format){var u={"P-256":32,"P-384":48,"P-521":66}[e.algorithm.namedCurve];if(null==(c=h.parse(e.keyData)))throw new Error("invalid key data.");if(null==(d=(g=c[1]).data.slice(g.header+1))||4!==d.shift()||d.length!==2*u)throw new Error("invalid key data.");if(o=d.slice(0,u),a=d.slice(u),!y.isBytes(o)||!y.isBytes(a))throw new Error("invalid key data.");var l={x:o,y:a};if(!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"public"}}}if("pkcs8"===e.format){var c;if(u={"P-256":32,"P-384":48,"P-521":66}[e.algorithm.namedCurve],null==(c=h.parse(e.keyData)))throw new Error("invalid key data.");var f=c[2];if(null==(d=h.parse(f.data.slice(f.header))))throw new Error("invalid key data.");var g,d,m=d[1].data.slice(d[1].header);if(null==(d=(g=h.parse(d[2][0].data)).data.slice(g.header+1))||4!==d.shift()||d.length!==2*u)throw new Error("invalid key data.");if(o=d.slice(0,u),a=d.slice(u),!y.isBytes(o)||!y.isBytes(a))throw new Error("invalid key data.");if(l={x:o,y:a,d:m},!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"private"}}}}catch(e){throw new y.error("DataError","")}},ae.exportKey=function(e){var r={"P-256":"1.2.840.10045.3.1.7 ","P-384":"1.3.132.0.34","P-521":"1.3.132.0.35"};if("raw"===e.format&&"public"===e.keyHandle.type)return{type:"keyExport",keyHandle:[4].concat(e.keyData.x,e.keyData.y)};if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("spki"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.10045.2.1"},{"OBJECT IDENTIFIER":r[e.algorithm.namedCurve]}]},{"BIT STRING":[4].concat(e.keyData.x,e.keyData.y)}]})};if("pkcs8"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{INTEGER:0},{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.10045.2.1"},{"OBJECT IDENTIFIER":r[e.algorithm.namedCurve]}]},{"OCTET STRING":{SEQUENCE:[{INTEGER:1},{"OCTET STRING":e.keyData.d},{APPLICATION:[{"BIT STRING":[4].concat(e.keyData.x,e.keyData.y)}],tag:1}]}}]})};throw new Error("unsupported export format.")},r.register("importKey","ECDH",ae.importKey),r.register("exportKey","ECDH",ae.exportKey),r.register("generateKey","ECDH",ae.generateKey),r.register("deriveBits","ECDH",ae.deriveBits),r.register("deriveKey","ECDH",ae.deriveKey));var ie,se=function(e){var r=d.bytesToDigits,t=d.digitsToBytes,n=new v.EllipticCurveOperatorFp(e),o=t(e.order).length,a=1===e.type;function i(r){var t=e.allocatePointStorage();return n.scalarMultiply(r,e.generator,t),{publicKey:t,privateKey:r}}function s(r){var t=[];return r||(r=Z.getBytes(e.order.length*d.DIGIT_NUM_BYTES)),d.reduce(d.bytesToDigits(r),e.order,t),i(t)}function u(t){t.length>o&&(t.length=o);var n=r(t);if(a){var i=8-e.rbits%8;d.shiftRight(n,n,i)}return d.reduce(n,e.order,n),n}return{createKey:function(e){return i(r(e))},generateKey:s,sign:function(n,a,i){i||(i=s());var l=i.publicKey.x,c=i.privateKey,f=r(n.d),h=u(a.slice()),g=[],p=[];d.reduce(l,e.order,l),d.modMul(l,f,e.order,g),d.add(g,h,g),d.reduce(g,e.order,g),d.modInvCT(c,e.order,p),d.modMul(g,p,e.order,g);var v=y.padFront(t(l,!0,o),0,o),m=y.padFront(t(g,!0,o),0,o);return v.concat(m)},verify:function(t,o,i){var s=Math.floor(o.length/2),l=r(o.slice(0,s)),c=r(o.slice(s)),f=u(i.slice()),y=[],h=[],g=new v.EllipticCurvePointFp(e,!1,r(t.x),r(t.y),null,!1);d.modInv(c,e.order,c),d.modMul(f,c,e.order,y),d.modMul(l,c,e.order,h);var p=e.allocatePointStorage(),m=e.allocatePointStorage();return a?(d.add(y,y,y),d.add(y,y,y),d.reduce(y,e.order,y),n.scalarMultiply(y,e.generator,p,!1),n.scalarMultiply(h,g,m,!1),n.convertToExtendedProjective(p),n.convertToExtendedProjective(m),n.add(m,p,p),n.normalize(p)):(n.scalarMultiply(y,e.generator,p),n.scalarMultiply(h,g,m),n.convertToJacobianForm(p),n.convertToMontgomeryForm(p),n.convertToMontgomeryForm(m),n.mixedAdd(p,m,p),n.convertToAffineForm(p),n.convertToStandardForm(p)),!p.isInfinity&&(d.reduce(p.x,e.order,p.x),0===d.compareDigits(p.x,l))}}};void 0!==r&&(se.sign=function(e){y.checkParam(e.algorithm.hash,"Object","algorithm.hash"),y.checkParam(e.algorithm.hash.name,"String","algorithm.hash.name"),y.checkParam(e.keyHandle.algorithm.namedCurve,"String","p.keyHandle.algorithm.namedCurve");var r=e.algorithm.hash.name,t=v.createCurve(e.keyHandle.algorithm.namedCurve.toUpperCase()),n=f[r.toUpperCase()]().computeHash(e.buffer);return se(t).sign(e.keyData,n)},se.verify=function(e){var r=e.algorithm.hash.name,t=v.createCurve(e.keyHandle.algorithm.namedCurve.toUpperCase()),n=f[r.toUpperCase()]().computeHash(e.buffer);return se(t).verify(e.keyData,e.signature,n)},se.generateKey=function(e){var r=v.createCurve(e.algorithm.namedCurve.toUpperCase()),t=se(r).generateKey(),n=d.digitsToBytes;function o(e){return e}var a=o(n(t.publicKey.x)),i=o(n(t.publicKey.y)),s=o(n(t.privateKey));return{type:"keyPairGeneration",keyPair:{publicKey:{keyData:{x:a,y:i},keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:["verify"],type:"public"}},privateKey:{keyData:{x:a,y:i,d:s},keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:["sign"],type:"private"}}}}},se.importKey=function(e){if("raw"===e.format){var r=e.keyData;if(4!==r[0])throw new Error("DataError");var t=~~((r.length-1)/2),n=e.algorithm.namedCurve.toUpperCase(),o=r.slice(1,t+1),a=r.slice(t+1);if(!1===v.validatePoint(n,o,a))throw new Error("DataError");return{type:"keyImport",keyData:{x:o,y:a},keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"public"}}}if("jwk"===e.format){if((l=p.jwkToKey(e.keyData,e.algorithm,["x","y","d","crv"])).d&&(!l.x||!l.y)){var i=se.curves[e.algorithm.namedCurve](),s=se(i).computePublicKey(l.d);l.x=s.x,l.y=s.y}if(!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable||l.extractable,usages:e.usages,type:l.d?"private":"public"}}}if("spki"===e.format){var u={"P-256":32,"P-384":48,"P-521":66}[e.algorithm.namedCurve];if(null==(c=h.parse(e.keyData)))throw new Error("invalid key data.");if(null==(d=(g=c[1]).data.slice(g.header+1))||4!==d.shift()||d.length!==2*u)throw new Error("invalid key data.");if(o=d.slice(0,u),a=d.slice(u),!y.isBytes(o)||!y.isBytes(a))throw new Error("invalid key data.");var l={x:o,y:a};if(!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"public"}}}if("pkcs8"===e.format){var c;if(u={"P-256":32,"P-384":48,"P-521":66}[e.algorithm.namedCurve],null==(c=h.parse(e.keyData)))throw new Error("invalid key data.");var f=c[2];if(null==(d=h.parse(f.data.slice(f.header))))throw new Error("invalid key data.");var g,d,m=d[1].data.slice(d[1].header);if(null==(d=(g=h.parse(d[2][0].data)).data.slice(g.header+1))||4!==d.shift()||d.length!==2*u)throw new Error("invalid key data.");if(o=d.slice(0,u),a=d.slice(u),!y.isBytes(o)||!y.isBytes(a))throw new Error("invalid key data.");if(l={x:o,y:a,d:m},!1===v.validatePoint(e.algorithm.namedCurve.toUpperCase(),l.x,l.y))throw new Error("DataError");return{type:"keyImport",keyData:l,keyHandle:{algorithm:e.algorithm,extractable:e.extractable,usages:e.usages,type:"private"}}}},se.exportKey=function(e){var r={"P-256":"1.2.840.10045.3.1.7 ","P-384":"1.3.132.0.34","P-521":"1.3.132.0.35"};if("raw"===e.format&&"public"===e.keyHandle.type)return{type:"keyExport",keyHandle:[4].concat(e.keyData.x,e.keyData.y)};if("jwk"===e.format)return{type:"keyExport",keyHandle:p.keyToJwk(e.keyHandle,e.keyData)};if("spki"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.10045.2.1"},{"OBJECT IDENTIFIER":r[e.algorithm.namedCurve]}]},{"BIT STRING":[4].concat(e.keyData.x,e.keyData.y)}]})};if("pkcs8"===e.format)return{type:"keyExport",keyHandle:h.encode({SEQUENCE:[{INTEGER:0},{SEQUENCE:[{"OBJECT IDENTIFIER":"1.2.840.10045.2.1"},{"OBJECT IDENTIFIER":r[e.algorithm.namedCurve]}]},{"OCTET STRING":{SEQUENCE:[{INTEGER:1},{"OCTET STRING":e.keyData.d},{APPLICATION:[{"BIT STRING":[4].concat(e.keyData.x,e.keyData.y)}],tag:1}]}}]})};throw new Error("unsupported export format.")},r.register("sign","ECDSA",se.sign),r.register("verify","ECDSA",se.verify),r.register("generateKey","ECDSA",se.generateKey),r.register("importKey","ECDSA",se.importKey),r.register("exportKey","ECDSA",se.exportKey));var ue=y;ie=function(){function e(){var e;return{postMessage:function(r){try{r.workerid=this.id,e=g.jsCryptoRunner({data:r})}catch(e){return void this.onerror({data:e,type:"error"})}this.onmessage({data:e})},onmessage:null,onerror:null,terminate:function(){}}}var o=function(e){return{process:function(r){return e.process(r)},finish:function(){return e.finish()},abort:function(){return e.abort()}}};function a(e){var r,t,n;return{dispatchEvent:function(o){"error"!==o.type?"process"!==o.data.type&&"finish"!==o.data.type?(this.result=e(o.data),t.apply(r,[this.result])):e(o.data.result,!0):n&&(o.data&&(o.data.stack="Error")&&(o.data.code=0),n.apply(r,[o.data||o]))},promise:r=new Promise(function(e,r){t=e,n=r}),result:null}}function i(e){var r=[],t=a(function(e,t){var n;if(e=e&&(n=e,s&&n.pop?new Uint8Array(n).buffer:n),!t)return e;r.resolve(e)});return t.stream=e.algorithm.stream,r.add=function(e){var t,n,o=new Promise(function(e,r){t=e,n=r});return o.label=e,r.push({resolve:t,reject:n,promise:o}),o},r.resolve=function(e){var t=r.shift();t.resolve.apply(t.promise,[e])},t.process=function(t){return e.operationSubType="process",e.buffer=ue.toArray(t),c.continueJob(this,ue.clone(e)),r.add("process")},t.finish=function(){return e.operationSubType="finish",e.buffer=[],c.continueJob(this,ue.clone(e)),r.add("finish")},t.abort=function(){c.abortJob(this)},t.algorithm=e.algorithm||null,t.key=e.keyHandle||null,t}var u=[];u.add=function(e,r){u.push({keyHandle:e,keyData:r})},u.remove=function(e){for(var r=0;r<u.length;r+=1)if(u[r].keyHandle===e)return void(u=u.splice(r,1))},u.lookup=function(e){for(var r=0;r<u.length;r+=1)if(u[r].keyHandle===e)return u[r].keyData;return null};var c=function(){var r=12,o=2,a=[],i=[],s=0,u=0,c=[],f="undefined"==typeof setImmediate?setTimeout:setImmediate;function y(){c.shift()()}var h=n?"available":"unavailable";function g(){!function(e){for(var r=a.length-1;r>=0;r-=1)a[r].isWebWorker===e&&(a[r].terminate(),a.splice(r,1))}(!l);for(var e=0;e<a.length;e++)if(!a[e].busy)return a[e];return null}function p(e){for(var r=0;r<a.length;r++)if(a[r]===e)return e.terminate(),void a.splice(r,1)}function d(e){for(var r=0;r<a.length;r++)if(a[r].operation===e)return a[r];return null}function v(e,r){i.push({operation:e,data:r,id:s++})}function m(e){if(e.busy=!1,l)if(i.length>0){var r,t=i.shift();if(E(t.operation,t.data),"process"===t.data.operationSubType){for(r=0;r<i.length;r++)t.operation===i[r].operation&&E(i[r].operation,i[r].data);for(r=i.length-1;r>=0;r--)t.operation===i[r].operation&&i.splice(r,1)}}else(function(){for(var e=0,r=0;r<a.length;r++)a[r].busy||(e+=1);return e})()>o&&p(e)}function w(r){var n;if("pending"===h)throw new Error("Creating new worker while workerstatus=pending");if("ready"===h)try{(n=new Worker(t)).postMessage({prngSeed:Z.getBytes(48)}),n.isWebWorker=!0}catch(r){l=!1,h="failed",n.terminate(),(n=e()).isWebWorker=!1}else(n=e()).isWebWorker=!1;return n.operation=r,n.id=u++,n.busy=!1,n.onmessage=function(e){if(!0!==e.data.initialized){var r=n.operation;e.target||(e.target={data:n.data});for(var t=0;t<i.length;t++)if(i[t].operation===n.operation){var o=i[t];return i.splice(t,1),void b(n,o.data)}e.data.hasOwnProperty("type")&&"process"===e.data.type||m(n),r.dispatchEvent(e)}},n.onerror=function(e){var r=n.operation;m(n),r.dispatchEvent(e)},function(e){a.push(e)}(n),n}function k(e,t){var n=null;if("pending"!==h)if(n=g(),l&&null===n&&a.length>=r)v(e,t);else{if(null===n&&(n=w(e)),null===n)throw v(e,t),new Error("could not create new worker");n.operation=e,n.busy=!0,t.workerid=n.id,b(n,t)}else v(e,t)}function E(e,r){var t=d(e);t?b(t,r):k(e,r)}function b(e,r){if(r.workerid=e.id,l)e.postMessage(r);else{var t=(o=r,function(){return e.postMessage(o)});n=t,c.push(n),f(y,0)}var n,o}return{runJob:k,continueJob:E,abortJob:function(e){var r=d(e);r&&p(r)},useWebWorkers:function(e){if("unavailable"!==h){if(!(!0===e&&"ready"===h||!1===e&&"available"===h)){if(!1===e&&"ready"===h)return l=!1,h="available",void ue.consoleLog("web workers disabled.");if("pending"!==h){h="pending";var r=new Worker(t);r.addEventListener("message",n,!1),r.addEventListener("error",n,!1),r.postMessage({prngSeed:Z.getBytes(48)})}}}else ue.consoleLog("web workers not available in this browser.");function n(e){var t=!(!e.data||!0!==e.data.initialized);if(r.removeEventListener("message",n,!1),r.removeEventListener("error",n,!1),r.terminate(),h=t?"ready":"failed",l=t,ue.consoleLog("web worker initialization "+(t?"succeeded. Now using web workers.":"failed. running synchronously."+(e.message||""))),i.length>0){var o=i.shift();k(o.operation,o.data)}}}}}(),f=[{name:"algorithm",type:"Object",required:!0},{name:"keyHandle",type:"Object",required:!0},{name:"buffer",type:"Array",required:!1},{name:"signature",type:"Array",required:!0},{name:"format",type:"String",required:!0},{name:"keyData",type:"Object",required:!0},{name:"extractable",type:"Boolean",required:!1},{name:"usages",type:"Array",required:!1},{name:"derivedKeyType",type:"Object",required:!0},{name:"length",type:"Number",required:!1},{name:"extractable",type:"Boolean",required:!0},{name:"usages",type:"Array",required:!0},{name:"keyData",type:"Array",required:!0}],h={encrypt:[0,1,2],decrypt:[0,1,2],sign:[0,1,2],verify:[0,1,3,2],digest:[0,2],generateKey:[0,6,7],importKeyRaw:[4,12,0,10,11],importKeyJwk:[4,5,0,10,11],exportKey:[0,4,1,6,7],deriveKey:[0,1,8,6,7],deriveBits:[0,1,9],wrapKey:[1,1,0],unwrapKey:[2,0,1,6,7]};function p(e){var r=u.lookup(e);if(!r)throw new Error("key not found");return r}function d(e,t,n){var s=function(e,r){var t,n,o,a,i={operationType:e};for("importKey"!==e||"raw"!==r[0]&&"spki"!==r[0]&&"pkcs8"!==r[0]||(e="importKeyRaw"),"importKey"===e&&"jwk"===r[0]&&(e="importKeyJwk"),t=h[e],a=0;a<t.length;a+=1)if(n=f[t[a]],null!=(o=r[a])){if(o.subarray&&(o=ue.toArray(o)),"ArrayBuffer"===ue.getObjectType(o)&&(o=ue.toArray(o)),y.getObjectType(o)!==n.type)throw new Error(n.name);"algorithm"===n.name&&(o.name=o.name.toUpperCase(),o.iv&&(o.iv=ue.toArray(o.iv)),o.publicExponent&&(o.publicExponent=ue.toArray(o.publicExponent)),o.salt&&(o.salt=ue.toArray(o.salt)),o.additionalData&&(o.additionalData=ue.toArray(o.additionalData)),o.hash&&!o.hash.name&&"String"===ue.getObjectType(o.hash)&&(o.hash={name:o.hash})),i.hasOwnProperty(n.name)?i[n.name+"1"]=o:i[n.name]=o}else if(n.required)throw new Error(n.name);return i}(e,t);!function(e,t){if(!r.exists(e,t))throw new Error("unsupported algorithm")}(e,s.algorithm.name),s.keyHandle&&(s.keyData=p(s.keyHandle)),s.keyHandle1&&(s.keyData1=p(s.keyHandle1)),s.algorithm&&s.algorithm.public&&(s.additionalKeyData=p(s.algorithm.public));var l=n?a(function(e){var r,t;switch(e.type){case"keyGeneration":case"keyImport":case"keyDerive":return e.keyPair?(u.add(e.keyPair.publicKey.keyHandle,e.keyPair.publicKey.keyData),u.add(e.keyPair.privateKey.keyHandle,e.keyPair.privateKey.keyData),{publicKey:e.keyPair.publicKey.keyHandle,privateKey:e.keyPair.privateKey.keyHandle}):(u.add(e.keyHandle,e.keyData),e.keyHandle);case"keyExport":return e.keyHandle;case"keyPairGeneration":return t=e.keyPair.privateKey,r=e.keyPair.publicKey,u.add(r.keyHandle,r.keyData),u.add(t.keyHandle,t.keyData),{publicKey:r.keyHandle,privateKey:t.keyHandle};default:throw new Error("Unknown key operation")}}):i(s);return(n||s.buffer||"deriveBits"===e||"wrapKey"===e)&&c.runJob(l,s),l.stream?Promise.resolve(o(l)):l.promise}return{publicMethods:{encrypt:function(e,r,t){return d("encrypt",arguments,0)},decrypt:function(e,r,t){return d("decrypt",arguments,0)},sign:function(e,r,t){return d("sign",arguments,0)},verify:function(e,r,t,n){return d("verify",arguments,0)},digest:function(e,r){return d("digest",arguments,0)},generateKey:function(e,r,t){return d("generateKey",arguments,1)},deriveKey:function(e,r,t,n,o){var a=this.deriveBits,i=this.importKey;return new Promise(function(s,u){var l;switch(t.name.toUpperCase()){case"AES-CBC":case"AES-GCM":l=t.length;break;case"HMAC":l=t.length||{"SHA-1":512,"SHA-224":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[t.hash.name.toUpperCase()];break;default:return void u(new Error("No Supported"))}a(e,r,l).then(function(e){return i("raw",e,t,n,o)}).then(function(e){s(e)})["catch"](function(e){u(e)})})},deriveBits:function(e,r,t){return d("deriveBits",arguments,0)},importKey:function(e,r,t,n,o){return d("importKey",arguments,1)},exportKey:function(e,r){return d("exportKey",[r.algorithm,e,r],1)},wrapKey:function(e,r,t,n){var o=this.encrypt,a=this.exportKey;return new Promise(function(i,s){!1===r.extractable||t.usages.indexOf("wrapKey")<0||t.algorithm.name.toUpperCase()!==n.name?s(new Error("InvalidAccessError")):a(e,r).then(function(r){return console.log(ue.toBase64(r)),o(n,t,"jwk"===e?ue.stringToBytes(JSON.stringify(r,null,0)):r)}).then(function(e){i(e)})["catch"](function(e){s(e)})})},unwrapKey:function(e,r,t,n,o,a,i){var s=this.decrypt,u=this.importKey;return new Promise(function(l,c){t.usages.indexOf("unwrapKey")<0||t.algorithm.name.toUpperCase()!==n.name?c(new Error("InvalidAccessError")):s(n,t,r).then(function(r){return u(e,"jwk"===e?JSON.parse(ue.bytesToString(r)):r,o,a,i)}).then(function(e){l(e)})["catch"](function(e){c(e)})})}},internalMethods:{useWebWorkers:c.useWebWorkers}}}();var le=function(){var e=y;return{wrapKey:function(r){var t=ee(r.keyData1,r.keyHandle1.algorithm.name,f["SHA-1"])(),n=p.keyToJwkOld(r.keyHandle,r.keyData),o={alg:r.keyHandle1.algorithm.name.toUpperCase(),enc:"A128GCM"},a=e.toBase64(JSON.stringify(o),!0),i=Z.getBytes(32),s=t.encrypt(i),u=e.toBase64(s,!0),l=Z.getBytes(12),c=e.toBase64(l,!0),y=a.concat(".",u,".",c),h=W(z.aes(i));h.init(l,e.stringToBytes(y),128);var g=h.encrypt(n),d=g.slice(-16),v={recipients:[{header:a,encrypted_key:u,integrity_value:e.toBase64(d,!0)}],initialization_vector:c,ciphertext:e.toBase64(g.slice(0,g.length-d.length),!0)};return e.stringToBytes(JSON.stringify(v))},unwrapKey:function(r){var t=e.fromBase64,n=JSON.parse(String.fromCharCode.apply(null,r.buffer)),o=(e.fromBase64(n.recipients[0].header),t(n.recipients[0].encrypted_key)),a=t(n.recipients[0].integrity_value),i=t(n.initialization_vector),s=t(n.ciphertext),u=f["SHA-1"](),l=ee(r.keyData,r.keyHandle.algorithm.name,u).decrypt(o),c=n.recipients[0].header.concat(".",n.recipients[0].encrypted_key,".",n.initialization_vector),y=W(z.aes(l));y.init(i,e.stringToBytes(c),128);var h=y.decrypt(s,a),g=p.jwkToKey(h,r.algorithm,["k"]);return{type:"keyImport",keyData:g.k,keyHandle:{algorithm:{name:r.algorithm.name},extractable:r.extractable||g.extractable,usages:r.usages,type:"secret"}}}}}();void 0!==r&&(r.register("wrapKey","AES-GCM",le.wrapKey),r.register("unwrapKey","AES-CBC",le.unwrapKey));var ce,fe={subtle:ie?ie.publicMethods:null,getRandomValues:function(e){var r,t=Z.getBytes(e.length);for(r=0;r<e.length;r+=1)e[r]=t[r];return e},initPrng:function(e){var r=Object.prototype.toString.call(e);if("[object Array]"!==r&&"[object Uint8Array]"!==r)throw new Error("entropyData must be a Array or Uint8Array");ce&&ce.reseed(e),Z.reseed(ce.read(48))},toBase64:function(e,r){return y.toBase64(e,r)},fromBase64:function(e){return y.fromBase64(e)},textToBytes:function(e){return y.stringToBytes(e)},bytesToText:function(e){return y.bytesToString(e)},asn1:h,url:t,version:msrCryptoVersion,useWebWorkers:function(e){return ie?ie.internalMethods.useWebWorkers(e):null}};(ce=ce||new function(e){var r=48,t=[],n=128,o=new J,a=!1,i=!1,s=e;function u(){var n,u=["Cookie","RedirectUri","ETag","x-ms-client-antiforgery-id","x-ms-client-request-id","x-ms-client-session-id","SubscriptionPool"],l=[];for(n=0;n<r;n+=1)l[n]=Math.floor(256*Math.random());var h=s.crypto||s.msCrypto;if(h&&"function"==typeof h.getRandomValues&&e.Uint8Array){var g=new e.Uint8Array(r);h.getRandomValues(g),l=l.concat(Array.apply(null,g)),i=!0}if("undefined"!=typeof XMLHttpRequest){var p=new XMLHttpRequest;for(n=0;n<u.length;n+=1)try{var d=p.getResponseHeader(u[n]);if(d){var v=y.stringToBytes(d);l=l.concat(v)}}catch(e){}}!i&&c&&(l=l.concat(t.splice(0,t.length)),f.startCollectors()),a?o.reseed(l):o.init(l),a=!0}function l(e){for(var r=0;r<e.length;++r)t.push(e[r]);t.length>=n&&f.stopCollectors()}var c=e&&e.addEventListener||"undefined"!=typeof document&&document.attachEvent,f={startCollectors:function(){if(!this.collectorsRegistered){if(e.addEventListener)e.addEventListener("mousemove",this.MouseEventCallBack,!0),e.addEventListener("load",this.LoadTimeCallBack,!0);else{if(!document.attachEvent)throw new Error("Can't attach events for entropy collection");document.attachEvent("onmousemove",this.MouseEventCallBack),document.attachEvent("onload",this.LoadTimeCallBack)}this.collectorsRegistered=1}},stopCollectors:function(){this.collectorsRegistered&&(e.removeEventListener?(e.removeEventListener("mousemove",this.MouseEventCallBack,1),e.removeEventListener("load",this.LoadTimeCallBack,1)):e.detachEvent&&(e.detachEvent("onmousemove",this.MouseEventCallBack),e.detachEvent("onload",this.LoadTimeCallBack)),this.collectorsRegistered=0)},MouseEventCallBack:function(e){var r=(new Date).valueOf(),t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0;l([255&r,r>>8&255,r>>16&255,r>>24&255,255&t,t>>8&255,255&n,n>>8&255])},LoadTimeCallBack:function(){var e=(new Date).valueOf();l([255&e,e>>8&255,e>>16&255,e>>24&255])}};return{init:function(){if(u(),!i&&c)try{f.startCollectors()}catch(e){}},reseed:function(e){o.reseed(e)},read:function(e){if(!a)throw new Error("Entropy pool is not initialized.");var r=o.getBytes(e);return u(),r}}}(e)).init();var ye=ce.read(48);return Z.init(ye),fe}()}),function(e,r){"undefined"==typeof Promise&&(e.Promise=function(){var e=function(r,t){if(!(this instanceof e))throw new Error("use 'new' keyword with Promise constructor");var n=null,o=null,a=[],i=[],s=[],u=[];this.then=function(r,t){var l;return n?(l=r(n.result))&&l.then?l:e.resolve(l):o?(l=t?t(o.result):o.result)&&l.then?l:e.resolve(l):(a.push(r),t&&i.push(t),new e(function(e,r){u.push(e),s.push(r)}))},this["catch"]=function(r){var t;return o?(t=r(o.result))&&t.then?t:e.resolve(t):(i.push(r),new e(function(e,r){u.push(e),s.push(r)}))},r(function(e){var r,t;for(t=0;t<a.length;t+=1)(r=a[t](e))&&r.then?(r.then(u[t]),s[t]&&r["catch"](s[t])):u[t]&&u[t](r);return void(n={result:e})},function(e){var r,t;for(t=0;t<i.length;t+=1)(r=i[t](e))&&r.then?r.then(u[t],s[t]):u[t]&&u[t](r);return void(o={result:e})})};return e.all=function(r){var t=[],n=0;function o(e,o){return function(a){t[e]=a,(n+=1)===r.length&&o(t)}}return new e(function(t,n){var a;function i(e){n(e)}for(a=0;a<r.length;a+=1)r[a].then?(r[a].then(o(a,t)),r[a]["catch"](i)):e.resolve(r[a]).then(o(a,t))})},e.race=function(r){var t=!1;function n(e){return function(r){t||(t=!0,e(r))}}return new e(function(e,t){for(var o=0;o<r.length;o+=1)r[o].then(n(e),n(t))})},e.reject=function(r){return new e(function(e,t){t(r)})},e.resolve=function(r){return new e(function(e,t){e(r)})},e}())}(this);